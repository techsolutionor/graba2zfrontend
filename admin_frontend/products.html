<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Modernize Free</title>
  <link rel="shortcut icon" type="image/png" href="./assets/images/logos/favicon.png" />
  <link rel="stylesheet" href="./assets/css/styles.min.css" />
  <link rel="stylesheet" href="./assets/css/navbar.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="./popupMessages.js"></script>
  <style>
    .input-group-text {
      border-top-right-radius: 0px !important;
      border-bottom-right-radius: 0px !important;
      padding-right: 0px !important;
      background-color: transparent !important;
      border-color: #DFE5EF !important;
      border-right: 0px !important;
    }

    .slug-input {
      border-left: 0px !important;
      padding-left: 0px !important;
    }

    .slug-input:focus {
      border-color: #DFE5EF !important;
    }
  </style>
  <script>
    ////(function() {
    //     let(function() {
    //     let path = window.location.pathname;
    //     if (path.endsWith(".html")) {
    //         let newPath = path.replace(".html", "");
    //         window.history.replaceState({}, document.title, newPath);
    //     }
    // })(); path = window.location.pathname;
    //     if (path.endsWith(".html")) {
    //         let newPath = path.replace(".html", "");
    //         window.history.replaceState({}, document.title, newPath);
    //     }
    // })();


    (function checkAuth() {
      const token = localStorage.getItem('token');

      if (!token) {
        window.location.replace('./login.html'); // Redirect to login page
      }
    })();
  </script>
  <script src="./popupMessages.js"></script>
</head>

<body>
  <!--  Body Wrapper -->
  <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
    data-sidebar-position="fixed" data-header-position="fixed">
    <!-- Sidebar Start -->
    <aside class="left-sidebar">
      <!-- Sidebar scroll-->
      <div>
        <div class="brand-logo d-flex align-items-center justify-content-between">
          <a href="./index.html" class="text-nowrap logo-img">
            <img src="./assets/images/logos/logo1.svg" width="180" alt="" />
          </a>
          <div class="close-btn d-xl-none d-block sidebartoggler cursor-pointer" id="sidebarCollapse">
            <i class="ti ti-x fs-8"></i>
          </div>
        </div>
        <!-- Sidebar navigation-->
        <div class="sidebar" id="sidebar">
          <a class="navbar-brand" href="#">
            <img src="./assets/images/logos/logo1.svg" width="180" alt="" />
          </a>

          <div class="section-title mt-9">HOME</div>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="./index.html">
                <i class="ti ti-layout-dashboard"></i> Dashboard
              </a>
            </li>
          </ul>
          <div class="section-title">PRODUCTS & STOCK</div>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="./products.html">
                <i class="fas fa-box"></i> Products
              </a>
            </li>
            <ul class="nav">
              <li class="nav-item">
                <a class="nav-link" href="#" id="purchaseToggle">
                  <i class="fas fa-shopping-cart"></i> Purchases
                </a>
                <ul class="nav-submenu" id="purchaseSubmenu">
                  <li><a href="./purchases.html" class="nav-link">List Purchase</a></li>
                  <li><a href="./add-purchase.html" class="nav-link">Add Purchase</a></li>
                  <li><a href="./return-purchase.html" class="nav-link">Purchase Return</a></li>
                </ul>
              </li>
            </ul>
            <li class="nav-item">
              <a class="nav-link" href="./damages.html">
                <i class="fas fa-exclamation-circle"></i> Damages
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./stock.html">
                <i class="fas fa-archive"></i> Stock
              </a>
            </li>
          </ul>
          <div class="section-title">POS & ORDERS</div>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="./pos.html">
                <i class="fas fa-cash-register"></i> POS
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./pos-orders.html">
                <i class="fas fa-receipt"></i> POS Orders
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./online-orders.html">
                <i class="fas fa-shopping-basket"></i> Online Orders
              </a>
            </li>
          </ul>

          <div class="section-title">PROMO</div>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="./coupons.html">
                <i class="fas fa-tags"></i> Coupons
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./promotions.html">
                <i class="fas fa-bullhorn"></i> Promotions
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./product-sections.html">
                <i class="fas fa-cube"></i> Product Sections
              </a>
            </li>
          </ul>

          <div class="section-title">COMMUNICATIONS</div>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="./push-notifications.html">
                <i class="fas fa-bell"></i> Push Notifications
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./subscribers.html">
                <i class="fas fa-users"></i> Subscribers
              </a>
            </li>
          </ul>
          <div class="section-title">USERS</div>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="./admin.html">
                <i class="fas fa-user"></i> Administrators
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./customer.html">
                <i class="fas fa-users"></i> Customers
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./employee.html">
                <i class="fas fa-user-tie"></i> Employees
              </a>
            </li>
          </ul>

          <div class="section-title">ACCOUNTS</div>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="#">
                <i class="fas fa-exchange-alt"></i> Transactions
              </a>
            </li>
          </ul>

          <div class="section-title">REPORTS</div>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="./sales-report.html">
                <i class="fas fa-chart-line"></i> Sales Report
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./products-report.html">
                <i class="fas fa-file-alt"></i> Products Report
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <i class="fas fa-credit-card"></i> Credit Balance Report
              </a>
            </li>
          </ul>

          <div class="section-title">SETUP</div>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" id="settingsToggle" href="#">
                <i class="fas fa-cog"></i> Settings
              </a>
            </li>
          </ul>

          <div class="submenu" id="settingsSubmenu">
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link" href="./company.html">
                  <i class="fas fa-building"></i> Company
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./site.html">
                  <i class="fas fa-globe"></i> Site
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./mail.html">
                  <i class="fas fa-envelope"></i> Mail
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./location-setup.html">
                  <i class="fas fa-map-marker-alt"></i> Location Setup
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./shipping-setup.html">
                  <i class="fas fa-truck"></i> Shipping Setup
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <i class="fas fa-lock"></i> OTP
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./notification.html">
                  <i class="fas fa-bell"></i> Notification
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./notification-alert.html">
                  <i class="fas fa-bell"></i> Notification alert
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./social-media.html">
                  <i class="fas fa-share-alt"></i> Social Media
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./cookies.html">
                  <i class="fas fa-cookie-bite"></i> Cookies
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./analytics.html">
                  <i class="fas fa-chart-bar"></i> Analytics
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./theme.html">
                  <i class="fas fa-paint-brush"></i> Theme
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./sliders.html">
                  <i class="fas fa-sliders-h"></i> Sliders
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./currencies.html">
                  <i class="fas fa-money-bill-wave"></i> Currencies
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./product-categories.html">
                  <i class="fas fa-tags"></i> Product Categories
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./product-attributes.html">
                  <i class="fas fa-cube"></i> Product Attributes
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./product-brands.html">
                  <i class="fas fa-tag"></i> Product Brands
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./supplier.html">
                  <i class="fas fa-industry"></i> Suppliers
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./outlets.html">
                  <i class="fas fa-store"></i> Outlets
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./benefits.html">
                  <i class="fas fa-gift"></i> Benefits
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./units.html">
                  <i class="fas fa-balance-scale"></i> Units
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./taxes.html">
                  <i class="fas fa-percent"></i> Taxes
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./page.html">
                  <i class="fas fa-file-alt"></i> Pages
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./role & permissions.html">
                  <i class="fas fa-user-shield"></i> Role & Permissions
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./languages-list.html">
                  <i class="fas fa-globe"></i> Languages
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./sms-gateway.html">
                  <i class="fas fa-comments"></i> Sms Gateway
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./payment-gateway.html">
                  <i class="fas fa-credit-card"></i> Payment Gateway
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./license.html">
                  <i class="fas fa-file-contract"></i> License
                </a>
              </li>
            </ul>
          </div>
        </div>
        <!-- End Sidebar navigation -->
      </div>
      <!-- End Sidebar scroll-->
    </aside>
    <!--  Sidebar End -->

    <!--  Main wrapper -->
    <div class="body-wrapper">
      <!--  Header Start -->
      <header class="app-header">
        <nav class="navbar navbar-expand-lg navbar-light">
          <div class="navbar-collapse justify-content-end px-0" id="navbarNav">
            <ul class="navbar-nav flex-row ms-auto align-items-center justify-content-end">
              <li class="nav-item dropdown">
                <a class="nav-link nav-icon-hover" href="javascript:void(0)" id="drop2" data-bs-toggle="dropdown"
                  aria-expanded="false">
                  <img src="./assets//images/profile/user-1.jpg" alt="" width="35" height="35" class="rounded-circle">
                </a>
                <div class="dropdown-menu dropdown-menu-end dropdown-menu-animate-up" aria-labelledby="drop2">
                  <div class="message-body">
                    <!-- <a href="http://127.0.0.1:5502/Office_Project/src/html/my-profile.html" class="d-flex align-items-center gap-2 dropdown-item"> -->
                    <a href="./my-profile.html" class="d-flex align-items-center gap-2 dropdown-item">
                      <i class="ti ti-user fs-6"></i>
                      <p class="mb-0 fs-3">My Profile</p>
                    </a>
                    <span id="auth">
                      <a href="./login.html" class="btn btn-outline-primary mx-3 mt-2 d-block"
                        id="loginButton">Logout</a>
                    </span>
                  </div>
                </div>
              </li>
            </ul>
          </div>
        </nav>
      </header>
      <div class="container-fluid">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title fw-semibold mb-4">Dashboard / Products</h5>
            <div class="container">
              <h5>Products</h5>

              <div
                class="actions-bar d-flex flex-column flex-md-row align-items-center align-items-lg-end justify-content-center justify-content-md-center justify-content-lg-end gap-2">
                <!-- Select Dropdown -->
                <select id="selectItems" class="form-select form-select-sm w-auto"
                  style="min-width: 80px; height: 38px; border-color: #0d6efd; color: #0d6efd; font-weight: bold; cursor: pointer;">
                  <option value="10">10</option>
                  <option value="20">25</option>
                  <option value="50">50</option>
                  <option value="100">100</option>
                  <option value="500">500</option>
                  <option value="1000">1000</option>
                </select>
                <div class="d-flex justify-content-center w-100" style="max-width: 105px;">
                  <button class="filter-btn btn btn-primary w-100">Filter</button>
                </div>
                <div id="dropdownSearch" class="dropdown-search d-none">
                  <div class="dropdown-header bg-light p-2 border rounded">Search Products</div>
                  <div class="dropdown-fields mt-2 p-2 border rounded bg-white">
                    <div class="filter-row row">
                      <div class="label-input col-12 col-lg-6 mb-2">
                        <label for="searchName">Name</label>
                        <input type="text" class="form-control filter-input" id="searchName" placeholder="Name">
                      </div>
                      <div class="label-input col-12 col-lg-6 mb-2">
                        <label for="searchCategory">Category</label>
                        <input type="text" class="form-control filter-input" id="searchCategory" placeholder="Category">
                      </div>
                    </div>
                    <div class="filter-row row">
                      <div class="label-input col-12 col-lg-6 mb-2">
                        <label for="searchStatus">Status</label>
                        <input type="text" class="form-control filter-input" id="searchStatus" placeholder="Status">
                      </div>
                      <div class="label-input col-12 col-lg-6 mb-2">
                        <label for="searchBuyingPrice">Buying Price</label>
                        <input type="number" class="form-control filter-input" id="searchBuyingPrice"
                          placeholder="Buying Price">
                      </div>
                    </div>
                    <div class="filter-row row">
                      <div class="label-input col-12 col-lg-6 mb-2">
                        <label for="searchBuyingPrice">Selling Price</label>
                        <input type="number" class="form-control filter-input" id="searchSellingPrice"
                          placeholder="Selling Price">
                      </div>
                    </div>
                    <div class="d-flex justify-content-between gap-2">
                      <button class="btn btn-success search-btn w-100" style="max-width: 200px;"
                        onclick="filterTable()">Search</button>
                      <button class="btn btn-secondary clear-btn w-100" style="max-width: 200px;"
                        onclick="clearFilters()">Clear</button>
                    </div>
                  </div>
                </div>
                <div class="d-flex justify-content-center w-100" style="max-width: 105px;">
                  <div class="dropdown w-100">
                    <button class="export-btn btn btn-warning w-100" type="button" data-bs-toggle="dropdown"
                      aria-expanded="false">Export</button>
                    <ul class="dropdown-menu mt-2" aria-labelledby="exportButton">
                      <li>
                        <a class="dropdown-item" href="#" id="exportButton"><i class="fas fa-file-excel"></i> XLS</a>
                      </li>
                    </ul>
                  </div>
                </div>


                <!-- Import Button -->
                <div class="d-flex justify-content-center w-100" style="max-width: 105px;">
                  <div class="dropdown w-100">
                    <button class="btn btn btn-primary w-100" type="button" data-bs-toggle="dropdown"
                      aria-expanded="false">
                      <i class="fas fa-file-import"></i>Import</button>
                    <ul class="dropdown-menu">
                      <a href="#" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#uploadModal">Upload
                        File</a>
                    </ul>
                  </div>
                </div>


                <div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel"
                  aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="uploadModalLabel">Products</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        <form id="uploadForm">
                          <div class="mb-3">
                            <label for="fileInput" class="form-label">UPLOAD FILE (XLS/XLSX) <span
                                class="text-danger">*</span></label>
                            <input class="form-control" type="file" id="fileInput" accept=".xls,.xlsx" required>
                          </div>
                        </form>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="saveButton">Upload</button>
                      </div>
                      <div id="uploadLoader" class="text-center d-none">
                        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
                      </div>

                    </div>
                  </div>
                </div>

                <!-- Add Product Button -->
                <div class="d-flex justify-content-center w-100" style="max-width: 150px;">
                  <button class="btn-add-product btn btn-info w-100" data-bs-toggle="modal"
                    data-bs-target="#createProductModal">➕ Add Product</button>
                </div>
              </div>

              <!-- Add Product Modal-->
              <div class="modal fade" id="createProductModal" tabindex="-1" aria-labelledby="createProductModalLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="createProductModalLabel">Create New Product</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <form id="createProductForm">
                        <div class="row g-3">
                          <div class="col-md-6">
                            <label for="name" class="form-label">Name</label>
                            <input type="text" id="name" class="form-control" required>
                          </div>

                          <div class="col-md-6">
                            <label for="sku" class="form-label">SKU</label>
                            <input type="text" id="sku" class="form-control" required>
                          </div>
                          <div class="col-md-12">
                            <label for="slug" class="form-label">Slug</label>
                            <div class="input-group mb-3">
                              <div class="input-group-prepend">
                                <span class="input-group-text"
                                  id="basic-addon3">https://graba2z.netlify.app/product-details.html?slug=</span>
                              </div>
                              <input type="text" id="slug" class="form-control slug-input" required>
                              <!-- <input type="text" class="form-control" id="basic-url" aria-describedby="basic-addon3"> -->
                            </div>

                          </div>
                        </div>
                        <div class="row g-3 mt-3">
                          <div class="col-md-6">
                            <label for="category" class="form-label">Category</label>
                            <select id="category" class="form-select">
                              <option value="">Select a Category</option>
                            </select>
                          </div>
                          <div class="col-md-6">
                            <label for="barcode" class="form-label">Barcode</label>
                            <input type="text" id="barcode" class="form-control" placeholder="">
                          </div>
                        </div>
                        <div id="specifications-container" style="display:none;">
                          <table class="table table-bordered mt-3">
                            <thead>
                              <tr>
                                <th>Specifications</th>
                                <th>Details</th>
                              </tr>
                            </thead>
                            <tbody id="specifications-table-body"></tbody>
                          </table>
                        </div>
                        <div class="row g-3 mt-3">
                          <div class="col-md-6">
                            <label for="buying price" class="form-label">Buying Price</label>
                            <input type="number" id="buying_price" class="form-control" required>
                          </div>
                          <div class="col-md-6">
                            <label for="selling price" class="form-label">Selling Price</label>
                            <input type="number" id="selling_price" class="form-control" required>
                          </div>
                        </div>
                        <div class="row g-3 mt-3">
                          <div class="col-md-6">
                            <label for="offer price" class="form-label">Offer Price</label>
                            <input type="number" id="offer_price" class="form-control">
                          </div>
                          <div class="col-md-6">
                            <label for="discount" class="form-label">Discount</label>
                            <input type="text" id="discount" class="form-control">
                          </div>
                        </div>
                        <div class="row g-3 mt-3">
                          <div class="col-md-6">
                            <label for="image1" class="form-label">Main Image</label>
                            <input type="file" id="image1" name="image1" class="form-control" accept="image/*">
                          </div>
                          <div class="col-md-6">
                            <label for="image2" class="form-label">Gallery Image 1</label>
                            <input type="file" id="image2" name="image2" class="form-control" accept="image/*">
                          </div>
                        </div>
                        <div class="row g-3 mt-3">
                          <div class="col-md-6">
                            <label for="image3" class="form-label">Gallery Image 2</label>
                            <input type="file" id="image3" name="image3" class="form-control" accept="image/*">
                          </div>
                          <div class="col-md-6">
                            <label for="image4" class="form-label">Gallery Image 3</label>
                            <input type="file" id="image4" name="image4" class="form-control" accept="image/*">
                          </div>
                        </div>
                        <div class="row g-3 mt-3">
                          <div class="col-md-6">
                            <label id="weightUnitLabel" for="tax" class="form-label">Tax</label>
                            <select id="tax" class="form-select">
                              <option value="">Select a Tax</option>
                            </select>
                          </div>
                          <div class="col-md-6">
                            <label for="brand" class="form-label">Brand</label>
                            <select id="brand" class="form-select">
                              <option value="">Select a Brand</option>
                            </select>
                          </div>
                        </div>
                        <div class="mt-4">
                          <label class="form-label">Status:</label>
                          <div class="d-flex">
                            <div class="form-check me-3">
                              <input class="form-check-input" type="radio" name="status" value="Active" checked>
                              <label class="form-check-label">Active</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="status" value="Inactive">
                              <label class="form-check-label">Inactive</label>
                            </div>
                          </div>
                        </div>
                        <div class="mt-3">
                          <label class="form-label">Can Purchasable:</label>
                          <div class="d-flex">
                            <div class="form-check me-3">
                              <input class="form-check-input" type="radio" name="can_purchasable" value="Yes" checked>
                              <label class="form-check-label">Yes</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="can_purchasable" value="No">
                              <label class="form-check-label">No</label>
                            </div>
                          </div>
                        </div>
                        <div class="mt-3">
                          <label class="form-label">Show Stock Out:</label>
                          <div class="d-flex">
                            <div class="form-check me-3">
                              <input class="form-check-input" type="radio" name="show_stock_out" value="Enable" checked>
                              <label class="form-check-label">Enable</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="show_stock_out" value="Disable">
                              <label class="form-check-label">Disable</label>
                            </div>
                          </div>
                        </div>
                        <div class="mt-3">
                          <label class="form-label">Refundable:</label>
                          <div class="d-flex">
                            <div class="form-check me-3">
                              <input class="form-check-input" type="radio" name="refundable" value="Yes" checked>
                              <label class="form-check-label">Yes</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="refundable" value="No">
                              <label class="form-check-label">No</label>
                            </div>
                          </div>
                        </div>
                        <div class="row g-3 mt-3">
                          <div class="col-md-6">
                            <label for="max purchase quantity" class="form-label">Maximum Purchase Quantity</label>
                            <input type="number" id="max_purchase_quantity" class="form-control" placeholder="">
                          </div>
                          <div class="col-md-6">
                            <label for="low stock quantity warning" class="form-label">Low Stock Quantity
                              Warning</label>
                            <input type="number" id="low_stock_warning" class="form-control" placeholder="">
                          </div>
                        </div>
                        <div class="row g-3 mt-3">
                          <div class="col-md-6">
                            <label for="unit" class="form-label">Unit</label>
                            <div class="input-group">
                              <select id="unit" class="form-select">
                                <option value="">Select a Unit</option>
                              </select>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <label for="weight" class="form-label">Weight</label>
                            <input type="text" id="weight" class="form-control" placeholder="">
                          </div>
                        </div>
                        <div class="mt-3">
                          <label for="tags" class="form-label">Tags</label>
                          <input type="text" id="tags" class="form-control" placeholder="">
                        </div>
                        <div class="mb-3">
                          <label for="short_description" class="form-label">Short Description</label>
                          <textarea id="short_description" class="form-control"></textarea>
                        </div>
                        <div class="mt-4">
                          <label for="description" class="form-label">Description</label>
                          <textarea id="description" class="form-control" placeholder=""></textarea>
                        </div>
                        <div class="mt-4">
                          <!-- <button type="button" class="btn btn-primary w-100" onclick="submitProductForm()">Submit</button> -->
                          <button type="button" class="btn btn-primary w-100"
                            onclick="submitProductForm(event)">Submit</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Edit Product Modal-->
              <!-- <div class="modal fade" id="updateProductModal" tabindex="-1" aria-labelledby="updateProductModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="updateProductModalLabel">Update Product</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                          <form id="updateProductForm">
                            <div class="row mb-3">
                              <div class="col-md-6">
                                <input type="text" id="update_name" class="form-control" placeholder="Name" required>
                              </div>
                              <div class="col-md-6">
                                <input type="text" id="update_sku" class="form-control" placeholder="SKU" required>
                              </div>
                            </div>
                            <div class="row mb-3">
                              <div class="col-md-6">
                                <input type="text" id="update_barcode" class="form-control" placeholder="Barcode">
                              </div>
                            </div>
                            <div class="row mb-3">
                              <div class="col-md-6">
                                <input type="number" id="update_buying_price" class="form-control" placeholder="Buying Price" required>
                              </div>
                              <div class="col-md-6">
                                <input type="number" id="update_selling_price" class="form-control" placeholder="Selling Price" required>
                              </div>
                            </div>
                            <div class="row mb-3">
                              <div class="col-md-6">
                                <select id="update_tax" class="form-select">
                                  <option value="No-VAT">Select a Tax</option>
                                  <option value="No-VAT">No-VAT</option>
                                  <option value="VAT-5">VAT-5</option>
                                  <option value="VAT-10">VAT-10</option>
                                  <option value="VAT-20">VAT-20</option>
                                </select>
                              </div>
                              <div class="col-md-6">  
                                <select id="update_brand" class="form-select">
                                  <option value="">Select a Brand</option>
                                </select>
                              </div>
                            </div>
                            <div class="row mb-3">
                              <div class="col-md-6">
                                <select id="update_category" class="form-select">
                                  <option value="">Select a Category</option>
                                </select>
                              </div>
                            </div>
                            <div class="mb-3">
                              <label class="form-label">Status:</label>
                              <div>
                                <label class="me-3"><input type="radio" name="update_status" value="Active" checked> Active</label>
                                <label><input type="radio" name="update_status" value="Inactive"> Inactive</label>
                              </div>
                            </div>
                            <div class="mb-3">
                              <label class="form-label">Can Purchasable:</label>
                              <div>
                                <label class="me-3"><input type="radio" name="update_can_purchasable" value="Yes" checked> Yes</label>
                                <label><input type="radio" name="update_can_purchasable" value="No"> No</label>
                              </div>
                            </div>
                            <div class="mb-3">
                              <label class="form-label">Show Stock Out:</label>
                              <div>
                                <label class="me-3"><input type="radio" name="update_show_stock_out" value="Enable" checked> Enable</label>
                                <label><input type="radio" name="update_show_stock_out" value="Disable"> Disable</label>
                              </div>
                            </div>
                            <div class="mb-3">
                              <label class="form-label">Refundable:</label>
                              <div>
                                <label class="me-3"><input type="radio" name="update_refundable" value="Yes" checked> Yes</label>
                                <label><input type="radio" name="update_refundable" value="No"> No</label>
                              </div>
                            </div>
                            <div class="row mb-3">
                              <div class="col-md-6">
                                <input type="number" id="update_max_purchase_quantity" class="form-control" placeholder="Max Purchase Quantity">
                              </div>
                              <div class="col-md-6">
                                <input type="number" id="update_low_stock_warning" class="form-control" placeholder="Low Stock Warning">
                              </div>
                            </div>
                            <div class="row mb-3">
                              <div class="col-md-6">
                                <input type="text" id="update_unit" class="form-control" placeholder="Unit">
                              </div>
                              <div class="col-md-6">
                                <input type="text" id="update_weight" class="form-control" placeholder="Weight">
                              </div>
                            </div>
                            <div class="row mb-3">
                              <div class="col">
                                <input type="text" id="update_tags" class="form-control" placeholder="Tags">
                              </div>
                            </div>
                            <div class="mb-3">
                              <textarea id="update_description" class="form-control" placeholder="Description"></textarea>
                            </div>
                            <div class="text-end">
                              <button type="button" class="btn btn-primary" onclick="submitUpdateProductForm()">Update</button>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div> -->
              <!-- Edit Product Modal-->
              <div class="modal fade" id="updateProductModal" tabindex="-1" aria-labelledby="updateProductModalLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-lg">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="updateProductModalLabel">Update Product</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <form id="updateProductForm">
                        <div class="row mb-3">
                          <div class="col-md-6">
                            <input type="text" id="update_name" class="form-control" placeholder="Name"
                              required="'true">
                          </div>
                          <div class="col-md-6 ">
                            <input type="text" id="update_sku" class="form-control" placeholder="SKU" required="'true">
                          </div>
                          <div class="col-md-12 mt-3">

                            <div class="input-group mb-3">
                              <div class="input-group-prepend">
                                <span class="input-group-text"
                                  id="basic-addon3">https://graba2z.netlify.app/product-details.html?slug=</span>
                              </div>
                              <input type="text" id="update_slug" class="form-control slug-input" placeholder="Slug"
                                required>
                            </div>
                          </div>
                        </div>
                        <div class="row mb-3">
                          <div class="col-md-6">
                            <input type="text" id="update_barcode" class="form-control" placeholder="Barcode" required>
                          </div>
                        </div>
                        <div class="row mb-3">
                          <div class="col-md-6">
                            <input type="number" id="update_buying_price" class="form-control"
                              placeholder="Buying Price" required>
                          </div>
                          <div class="col-md-6">
                            <input type="number" id="update_selling_price" class="form-control"
                              placeholder="Selling Price" required>
                          </div>
                        </div>
                        <div class="row mb-3">
                          <div class="col-md-6">
                            <select id="update_tax" class="form-select">
                              <option value="No-VAT">Select a Tax</option>
                              <option value="No-VAT">No-VAT</option>
                              <option value="VAT-5">VAT-5</option>
                              <option value="VAT-10">VAT-10</option>
                              <option value="VAT-20">VAT-20</option>
                            </select>
                          </div>
                          <div class="col-md-6">
                            <select id="update_brand" class="form-select">
                              <option value="">Select a Brand</option>
                            </select>
                          </div>
                        </div>
                        <div class="row mb-3">
                          <div class="col-md-6">
                            <select id="update_category" class="form-select">
                              <option value="">Select a Category</option>
                            </select>
                          </div>
                        </div>
                        <div class="mb-3">
                          <label class="form-label">Status:</label>
                          <div>
                            <label class="me-3"><input type="radio" name="update_status" value="Active" checked>
                              Active</label>
                            <label><input type="radio" name="update_status" value="Inactive"> Inactive</label>
                          </div>
                        </div>
                        <div class="mb-3">
                          <label class="form-label">Can Purchasable:</label>
                          <div>
                            <label class="me-3"><input type="radio" name="update_can_purchasable" value="Yes" checked>
                              Yes</label>
                            <label><input type="radio" name="update_can_purchasable" value="No"> No</label>
                          </div>
                        </div>
                        <div class="mb-3">
                          <label class="form-label">Show Stock Out:</label>
                          <div>
                            <label class="me-3"><input type="radio" name="update_show_stock_out" value="Enable" checked>
                              Enable</label>
                            <label><input type="radio" name="update_show_stock_out" value="Disable"> Disable</label>
                          </div>
                        </div>
                        <div class="mb-3">
                          <label class="form-label">Refundable:</label>
                          <div>
                            <label class="me-3"><input type="radio" name="update_refundable" value="Yes" checked>
                              Yes</label>
                            <label><input type="radio" name="update_refundable" value="No"> No</label>
                          </div>
                        </div>
                        <div class="row mb-3">
                          <div class="col-md-6">
                            <input type="number" id="update_max_purchase_quantity" class="form-control"
                              placeholder="Max Purchase Quantity">
                          </div>
                          <div class="col-md-6">
                            <input type="number" id="update_low_stock_warning" class="form-control"
                              placeholder="Low Stock Warning">
                          </div>
                        </div>
                        <div class="row mb-3">
                          <div class="col-md-6">
                            <input type="text" id="update_unit" class="form-control" placeholder="Unit">
                          </div>
                          <div class="col-md-6">
                            <input type="text" id="update_weight" class="form-control" placeholder="Weight">
                          </div>
                        </div>
                        <div class="row mb-3">
                          <div class="col">
                            <input type="text" id="update_tags" class="form-control" placeholder="Tags">
                          </div>
                        </div>
                        <div class="mb-3">
                          <textarea id="update_short_description" class="form-control"
                            placeholder="Short Description"></textarea>
                        </div>
                        <div class="mb-3">
                          <textarea id="update_description" class="form-control" placeholder="Description"></textarea>
                        </div>
                        <div class="text-end">
                          <button type="submit" class="btn btn-primary"
                            onclick="submitUpdateProductForm()">Update</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>

              <!-- View Product Modal -->
              <div class="modal fade" id="viewProductModal" tabindex="-1" aria-labelledby="viewProductModalLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="viewProductModalLabel">Product Details</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="modal-content">
                      <!-- Product details will be dynamically inserted here -->
                      <div id="productDetails">
                        <!-- Example of dynamically inserted content -->
                        <p><strong>Name:</strong> <span id="productName"></span></p>
                        <p><strong>Slug:</strong> <span id="productSlug"></span></p>
                        <p><strong>SKU:</strong> <span id="productSKU"></span></p>
                        <p><strong>Category:</strong> <span id="productCategory"></span></p>
                        <p><strong>Barcode:</strong> <span id="productBarcode"></span></p>
                        <p><strong>Buying Price:</strong> <span id="productBuyingPrice"></span></p>
                        <p><strong>Selling Price:</strong> <span id="productSellingPrice"></span></p>
                        <p><strong>Tax:</strong> <span id="productTax"></span></p>
                        <p><strong>Brand:</strong> <span id="productBrand"></span></p>
                        <p><strong>Status:</strong> <span id="productStatus"></span></p>
                        <p><strong>Refundable:</strong> <span id="productRefundable"></span></p>
                        <p><strong>Short Description:</strong> <span id="productShortDescription"></span></p>
                        <p><strong>Description:</strong> <span id="productDescription"></span></p>
                        <p><strong>Image:</strong> <img id="productImage" src="" alt="" width="100"></p>
                        <div id="productImagesWrapper" class="d-flex flex-wrap"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>


              <div class="table-responsive mt-4">
                <table class="table table-bordered table-striped">
                  <thead>
                    <tr>
                      <th scope="col">Name</th>
                      <th scope="col">Slug</th>
                      <th scope="col">Category</th>
                      <th scope="col">Brand</th>
                      <th scope="col">Buying Price</th>
                      <th scope="col">Selling Price</th>
                      <th scope="col">Status</th>
                      <th scope="col">Short Description</th>
                      <th scope="col">Action</th>
                    </tr>
                  </thead>
                  <tbody id="productsTableBody" class="products-table-body">
                    <!-- Dynamic rows will be added here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>


        <script src="./assets/libs/jquery/dist/jquery.min.js"></script>
        <script src="./assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
        <script src="./assets/js/sidebarmenu.js"></script>
        <script src="./assets/js/app.min.js"></script>
        <script src="./assets/libs/simplebar/dist/simplebar.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
        <script src="./apiConfig/apiConfig.js"></script>
        <script>

          document.addEventListener('DOMContentLoaded', () => {
            const purchaseToggle = document.getElementById('purchaseToggle');
            const purchaseSubmenu = document.getElementById('purchaseSubmenu');

            purchaseToggle.addEventListener('click', (event) => {
              event.preventDefault();
              purchaseSubmenu.style.display = (purchaseSubmenu.style.display === 'none' || purchaseSubmenu.style.display === '') ? 'block' : 'none';
            });
          });
          async function populateTexOptions() {
            const token = localStorage.getItem('token');
            try {
              const response = await fetch(`https://grabatoz-production.up.railway.app/api/taxes`, {
                method: 'GET',
                headers: {
                  'Authorization': `${token}`,
                  'Content-Type': 'application/json',
                },
              });

              if (!response.ok) {
                throw new Error(`Failed to fetch taxes: ${response.statusText}`);
              }

              const taxes = await response.json();
              const taxSelect = document.getElementById('tax');
              taxSelect.innerHTML = '<option value="">Select a Tax</option>';

              // Map API response to match your tex enum values
              taxes.forEach(tax => {
                const option = document.createElement('option');
                option.value = tax.code; // Assuming your API returns codes like 'No-VAT', 'VAT-5'
                option.textContent = tax.name; // Display name for UI
                taxSelect.appendChild(option);
              });
            } catch (error) {
              console.error('Error loading tax options:', error);
              showErrorMessage(`Error loading tax options: ${error.message}`);
            }
          }


          // This function is called when the page loads
          window.onload = function () {
            const token = localStorage.getItem('token');
            const authContainer = document.getElementById('auth');

            if (token) {
              // If token exists, user is logged in, show the logout button
              authContainer.innerHTML = `
            <a href="#" class="btn btn-outline-danger mx-3 mt-2 d-block" id="logoutButton">Logout</a>
        `;

              // Add event listener to logout button
              document.getElementById('logoutButton').addEventListener('click', logout);
            } else {
              // If token doesn't exist, show the login button
              authContainer.innerHTML = `
            <a href="./login.html" class="btn btn-outline-primary mx-3 mt-2 d-block" id="loginButton">Login</a>
        `;
            }
          }
          // Call this when page loads
          populateTexOptions();
          // Logout function
          function logout() {
            // Remove the token from localStorage
            localStorage.removeItem('token');

            // Redirect to login page after logout
            window.location.href = './login.html';
          }

          function checkTokenExpiration() {
            const token = localStorage.getItem('token');

            if (token) {
              const decodedToken = JSON.parse(atob(token.split('.')[1]));

              // Check if the token has expired
              const expirationTime = decodedToken.exp * 1000; // Convert to milliseconds
              const currentTime = Date.now();

              if (currentTime > expirationTime) {
                showErrorMessage('Session expired. Please log in again.');
                logout(); // Log out the user if the token has expired
              }
            }
          }

          // Call checkTokenExpiration() on page load or on regular intervals (e.g., every 5 minutes)
          checkTokenExpiration();

          document.addEventListener('DOMContentLoaded', function () {
            const navLinks = document.querySelectorAll('.sidebar .nav-link');
            const settingsToggle = document.getElementById('settingsToggle');
            const settingsSubmenu = document.getElementById('settingsSubmenu');

            // Handle submenu toggle
            settingsToggle.addEventListener('click', function (event) {
              event.preventDefault();
              settingsSubmenu.style.display = (settingsSubmenu.style.display === 'block') ? 'none' : 'block';
            });

            // Handle active link
            navLinks.forEach(link => {
              link.addEventListener('click', function () {
                // Remove active class from all links
                navLinks.forEach(nav => nav.classList.remove('active'));
                // Add active class to the clicked link
                this.classList.add('active');
              });
            });
          });


          async function populateUnitOptions() {
            const token = localStorage.getItem('token');
            const apiUrl = `https://grabatoz-production.up.railway.app/api/units`;

            try {
              const response = await fetch(apiUrl, {
                method: 'GET',
                headers: {
                  'Authorization': `${token}`,
                  'Content-Type': 'application/json',
                },
              });

              if (!response.ok) {
                const errorData = await response.json();
                console.error('API Error:', errorData);
                throw new Error(`Failed to fetch units: ${errorData.message || 'Unknown error'}`);
              }

              const units = await response.json();

              // Populate the unit select field
              const unitSelect = document.getElementById('unit');
              unitSelect.innerHTML = '<option value="">Select a Unit</option>';

              units.forEach(unit => {
                const option = document.createElement('option');
                option.value = unit.name; // Use the unit name as the value
                option.textContent = unit.name; // Display the unit name
                unitSelect.appendChild(option);
              });

              // Update the weight field dynamically when the unit changes
              unitSelect.addEventListener('change', () => {
                const selectedUnit = unitSelect.value;
                const weightUnitLabel = document.getElementById('weightUnitLabel');
                weightUnitLabel.textContent = selectedUnit || ''; // Update label or clear it
              });

              console.log('Unit options populated successfully');
            } catch (error) {
              console.error('Error populating unit options:', error);
              showErrorMessage(`Error loading units: ${error.message}`);
            }
          }

          async function populateTaxOptions() {
            const token = localStorage.getItem('token');
            const apiUrl = `https://grabatoz-production.up.railway.app/api/taxes`;

            try {
              const response = await fetch(apiUrl, {
                method: 'GET',
                headers: {
                  'Authorization': `${token}`,
                  'Content-Type': 'application/json',
                },
              });

              if (!response.ok) {
                const errorData = await response.json();
                console.error('API Error:', errorData);
                throw new Error(`Failed to fetch taxes: ${errorData.message || 'Unknown error'}`);
              }

              const taxes = await response.json();

              // Populate the tax select field
              const taxSelect = document.getElementById('tax');
              taxSelect.innerHTML = '<option value="">Select a Tax</option>';

              taxes.forEach(tax => {
                const option = document.createElement('option');
                option.value = tax.id; // Use tax ID as value
                option.textContent = tax.name; // Display the tax name
                taxSelect.appendChild(option);
              });

              console.log('Tax options populated successfully');
            } catch (error) {
              console.error('Error populating tax options:', error);
              showErrorMessage(`Error loading taxes: ${error.message}`);
            }
          }

          const apiUrl = `https://grabatoz-production.up.railway.app/api/products`;
          // const apiUrl = `http://localhost:3000/api/products`;

          async function populateBrandOptions() {
            const token = localStorage.getItem('token');
            const apiUrl = `https://grabatoz-production.up.railway.app/api/product-brands`;

            try {
              const response = await fetch(apiUrl, {
                method: 'GET',
                headers: {
                  'Authorization': `${token}`,
                  'Content-Type': 'application/json',
                },
              });

              if (!response.ok) {
                const errorData = await response.json();
                console.error('API Error:', errorData);
                throw new Error(`Failed to fetch product brands: ${errorData.message || 'Unknown error'}`);
              }

              const brands = await response.json();

              // Populate the brand select fields
              const brandSelect = document.getElementById('brand');
              const updateBrandSelect = document.getElementById('update_brand');

              // Clear existing options
              brandSelect.innerHTML = '<option value="">Select a Brand</option>';
              updateBrandSelect.innerHTML = '<option value="">Select a Brand</option>';

              // Populate new options
              brands.forEach(brand => {
                const option = document.createElement('option');
                option.value = brand.name; // Set the ID as the value
                option.textContent = brand.name; // Display the name
                brandSelect.appendChild(option);

                const updateOption = option.cloneNode(true); // Clone for update form
                updateBrandSelect.appendChild(updateOption);
              });

              console.log('Brand options populated successfully');
            } catch (error) {
              console.error('Error populating brand options:', error);
              showErrorMessage(`Error loading brands: ${error.message}`);
            }
          }

          async function populateCategoryOptions() {
            const token = localStorage.getItem('token');
            const apiUrl = `https://grabatoz-production.up.railway.app/api/product-categories`;

            try {
              const response = await fetch(apiUrl, {
                method: 'GET',
                headers: {
                  'Authorization': `${token}`, // Added 'Bearer' for better practice in token authentication
                  'Content-Type': 'application/json',
                },
              });

              if (!response.ok) {
                const errorData = await response.json();
                console.error('API Error:', errorData);
                throw new Error(`Failed to fetch product categories: ${errorData.message || 'Unknown error'}`);
              }

              const categories = await response.json();  // Expecting 'categories' here, not 'brands'

              // Populate the category select fields
              const categorySelect = document.getElementById('category');
              const updateCategorySelect = document.getElementById('update_category');

              // Clear existing options
              categorySelect.innerHTML = '<option value="">Select a Category</option>';
              updateCategorySelect.innerHTML = '<option value="">Select a Category</option>';

              // Populate new options for category selection
              categories.forEach(category => {  // Use 'category' instead of 'brand'
                const option = document.createElement('option');
                option.value = category.id;  // Assuming 'id' is the category's unique identifier
                option.textContent = category.name; // Display the name of the category
                categorySelect.appendChild(option);

                const updateOption = option.cloneNode(true); // Clone for the update form
                updateCategorySelect.appendChild(updateOption);
              });

              console.log('Category options populated successfully');
            } catch (error) {
              console.error('Error populating category options:', error);
              showErrorMessage(`Error loading categories: ${error.message}`);
            }
          }

          // async function loadCategorySpecifications() {
          //   const categoryId = document.getElementById('category').value;
          //   if (!categoryId) {
          //     document.getElementById('specifications-container').style.display = 'none';
          //     return;
          //   }

          //   try {
          //     const response = await fetch(`https://grabatoz-production.up.railway.app/api/product-categories/${categoryId}/specifications`);
          //     const data = await response.json();

          //     if (data.success && data.specifications) {
          //       populateSpecificationsTable(data.specifications);
          //     } else {
          //       showErrorMessage('No specifications found for this category.');
          //     }
          //   } catch (error) {
          //     console.error('Error fetching specifications:', error);
          //     showErrorMessage('An error occurred while fetching specifications.');
          //   }
          // }

          // Function to populate the specifications table
          //           async function loadCategorySpecifications() {
          //     const categoryId = document.getElementById('category').value;
          //     const container = document.getElementById('specifications-container');
          //     const tableBody = document.getElementById('specifications-table-body');

          //     // Clear and hide if no category selected
          //     if (!categoryId) {
          //         tableBody.innerHTML = '';
          //         container.style.display = 'none';
          //         return;
          //     }

          //     try {
          //         const response = await fetch(`https://grabatoz-production.up.railway.app/api/product-categories/${categoryId}/specifications`);
          //         const data = await response.json();

          //         if (!response.ok) {
          //             throw new Error(data.message || 'Failed to fetch specifications');
          //         }

          //         tableBody.innerHTML = ''; // Clear existing rows

          //         if (data.specifications && data.specifications.length > 0) {
          //             data.specifications.forEach(spec => {
          //                 const row = document.createElement('tr');
          //                 row.innerHTML = `
          //                     <td>${spec}</td>
          //                     <td><input type="text" class="form-control" placeholder="Enter ${spec}" required></td>
          //                 `;
          //                 tableBody.appendChild(row);
          //             });
          //             container.style.display = 'block';
          //         } else {
          //             container.style.display = 'none';
          //             showInfoMessage('No specifications found for this category');
          //         }
          //     } catch (error) {
          //         console.error('Error loading specifications:', error);
          //         tableBody.innerHTML = '';
          //         container.style.display = 'none';
          //         showErrorMessage(error.message || 'Error loading specifications');
          //     }
          // }

          // Initialize event listener
          async function loadCategorySpecifications() {
            const categoryId = document.getElementById('category').value;
            const container = document.getElementById('specifications-container');
            const tableBody = document.getElementById('specifications-table-body');

            if (!categoryId) {
              tableBody.innerHTML = '';
              container.style.display = 'none';
              return;
            }

            try {
              const token = localStorage.getItem('token');
              if (!token) {
                throw new Error('Please login to continue');
              }

              const response = await fetch(`https://grabatoz-production.up.railway.app/api/product-categories/${categoryId}/specifications`, {
                headers: {
                  'Authorization': `Bearer ${token}`,
                  'Content-Type': 'application/json'
                }
              });

              if (response.status === 401) {
                // Token expired or invalid
                localStorage.removeItem('token');
                window.location.href = '/login';
                return;
              }

              const data = await response.json();

              if (!response.ok) {
                throw new Error(data.message || 'Failed to fetch specifications');
              }

              tableBody.innerHTML = '';

              if (data.specifications && data.specifications.length > 0) {
                data.specifications.forEach(spec => {
                  const row = document.createElement('tr');
                  row.innerHTML = `
                    <td>${spec}</td>
                    <td><input type="text" class="form-control" placeholder="Enter ${spec}" required></td>
                `;
                  tableBody.appendChild(row);
                });
                container.style.display = 'block';
              } else {
                container.style.display = 'none';
                showErrorMessage('No specifications found for this category');
              }
            } catch (error) {
              console.error('Error loading specifications:', error);
              tableBody.innerHTML = '';
              container.style.display = 'none';
              showErrorMessage(error.message || 'Error loading specifications');

              if (error.message.includes('token') || error.message.includes('login')) {
                // Redirect to login if token issues
                window.location.href = '/login';
              }
            }
          }

          // Initialize event listener
          document.getElementById('category').addEventListener('change', loadCategorySpecifications);

          function populateSpecificationsTable(specifications) {
            const tableBody = document.getElementById('specifications-table-body');
            tableBody.innerHTML = ''; // Clear previous rows

            specifications.forEach(spec => {
              const row = document.createElement('tr');

              const specCell = document.createElement('td');
              specCell.textContent = spec; // Display the specification name
              row.appendChild(specCell);

              const detailsCell = document.createElement('td');
              const input = document.createElement('input');
              input.type = 'text';
              input.classList.add('form-control');
              input.id = `spec-details-${spec}`; // Use the spec name as the ID for input
              detailsCell.appendChild(input);
              row.appendChild(detailsCell);

              tableBody.appendChild(row);
            });

            document.getElementById('specifications-container').style.display = 'block';
          }

          document.addEventListener('DOMContentLoaded', () => {
            populateBrandOptions();
            populateUnitOptions();
            populateTaxOptions();
            populateCategoryOptions()

          });

          // async function submitProductForm(event) {
          //   event.preventDefault();

          //   // Basic validation
          //   const requiredFields = ['name', 'slug', 'sku', 'category', 'brand', 'buying_price', 'selling_price'];
          //   const missingFields = requiredFields.filter(field => {
          //     const element = document.getElementById(field);
          //     return !element || !element.value.trim();
          //   });

          //   if (missingFields.length > 0) {
          //     showErrorMessage(`Please fill in all required fields: ${missingFields.join(', ')}`);
          //     return;
          //   }

          //   // Prepare form data
          //   const formData = new FormData();
          //   const formElements = document.getElementById('createProductForm').elements;

          //   // Add all simple fields
          //   ['name', 'slug', 'sku', 'category', 'barcode', 'buying_price',
          //     'selling_price', 'tax', 'brand', 'unit', 'weight', 'tags',
          //     'description', 'offer_price', 'discount', 'max_purchase_quantity',
          //     'low_stock_warning'].forEach(field => {
          //       if (document.getElementById(field)) {
          //         formData.append(field, document.getElementById(field).value);
          //       }
          //     });

          //   // Add radio button values
          //   ['status', 'can_purchasable', 'show_stock_out', 'refundable'].forEach(field => {
          //     const selected = document.querySelector(`input[name="${field}"]:checked`);
          //     if (selected) formData.append(field, selected.value);
          //   });

          //   // Handle specifications
          //   const specifications = [];
          //   const details = [];
          //   document.querySelectorAll('#specifications-table-body tr').forEach(row => {
          //     const specName = row.cells[0].textContent.trim();
          //     const detailValue = row.cells[1].querySelector('input').value.trim();
          //     if (specName && detailValue) {
          //       specifications.push(specName);
          //       details.push(detailValue);
          //     }
          //   });
          //   formData.append('specifications', JSON.stringify(specifications));
          //   formData.append('details', JSON.stringify(details));

          //   // Handle file uploads
          //   for (let i = 1; i <= 4; i++) {
          //     const fileInput = document.getElementById(`image${i}`);
          //     if (fileInput && fileInput.files[0]) {
          //       formData.append('images', fileInput.files[0]);
          //     }
          //   }

          //   try {
          //     const response = await fetch(`https://grabatoz-production.up.railway.app/api/products`, {
          //       method: 'POST',
          //       headers: {
          //         'Authorization': `${localStorage.getItem('token')}`,
          //       },
          //       body: formData,
          //     });

          //     const data = await response.json();

          //     if (!response.ok) {
          //       throw new Error(data.message || 'Failed to save product');
          //     }

          //     showSuccessMessage('Product created successfully!');
          //     // Reset form and close modal
          //     document.getElementById('createProductForm').reset();
          //     bootstrap.Modal.getInstance(document.getElementById('createProductModal')).hide();
          //     // Optional: Refresh product list
          //   } catch (error) {
          //     console.error('Product submission error:', error);
          //     showErrorMessage(error.message || 'Error saving product');
          //   }
          // }
          // document.getElementById('category').addEventListener('change', loadCategorySpecifications);


          // async function fetchProducts() {
          //             const token = localStorage.getItem('token'); // Assuming the token is stored in local storage

          //             try {
          //                 const response = await fetch(apiUrl, {
          //                     method: 'GET',
          //                     headers: {
          //                         'Authorization': token, 
          //                     },
          //                 });

          //                 if (!response.ok) throw new Error('Failed to fetch products');

          //                 const products = await response.json();
          //                 const productsTableBody = document.getElementById('productsTableBody');
          //                 productsTableBody.innerHTML = ''; // Clear existing rows

          //                 // Loop through purchases and create table rows
          //                 products.forEach(products => {
          //                     const row = document.createElement('tr');
          //                     row.innerHTML = `
          //                         <td>${products.name}</td>
          //                         <td>${products.slug}</td>
          //                         <td>${products.category}</td>
          //                         <td>${products.brand}</td>
          //                         <td>${products.buying_price}</td>
          //                         <td>${products.selling_price}</td>
          //                         <td>${products.status}</td>
          //                         <td class="action-buttons">
          //                             <button class="btn btn-view" onclick="showViewForm(${products.id})">👁</button>
          //                             <button class="btn btn-edit" onclick="openUpdateForm(${products.id})">✏️</button>
          //                             <button class="btn btn-delete" onclick="showConfirmDialog(${products.id})">🗑</button>
          //                         </td>
          //                     `;
          //                     productsTableBody.appendChild(row);
          //                 });
          //               } catch (error) {
          //                 console.error('Error fetching products:', error);
          //             }
          //         }



          // async function submitProductForm(event) {
          //   event.preventDefault();

          //   // Validate tax selection
          //   const taxSelect = document.getElementById('tax');
          //   if (!taxSelect.value) {
          //     showErrorMessage('Please select a tax option');
          //     taxSelect.focus();
          //     return;
          //   }

          //   // Prepare all form data
          //   const formData = new FormData();

          //   // Add text fields
          //   formData.append('name', document.getElementById('name').value);
          //   formData.append('slug', document.getElementById('slug').value);
          //   formData.append('sku', document.getElementById('sku').value);
          //   formData.append('category', document.getElementById('category').value);
          //   formData.append('barcode', document.getElementById('barcode').value);
          //   formData.append('buying_price', document.getElementById('buying_price').value);
          //   formData.append('selling_price', document.getElementById('selling_price').value);
          //   formData.append('tex', taxSelect.value); // Using tex field
          //   formData.append('brand', document.getElementById('brand').value);
          //   formData.append('unit', document.getElementById('unit').value);
          //   formData.append('weight', document.getElementById('weight').value);
          //   formData.append('tags', document.getElementById('tags').value);
          //   formData.append('description', document.getElementById('description').value);
          //   formData.append('offer_price', document.getElementById('offer_price').value || '0');
          //   formData.append('discount', document.getElementById('discount').value || '0');
          //   formData.append('max_purchase_quantity', document.getElementById('max_purchase_quantity').value || '0');
          //   formData.append('low_stock_warning', document.getElementById('low_stock_warning').value || '0');

          //   // Add radio button values
          //   formData.append('status', document.querySelector('input[name="status"]:checked').value);
          //   formData.append('can_purchasable', document.querySelector('input[name="can_purchasable"]:checked').value);
          //   formData.append('show_stock_out', document.querySelector('input[name="show_stock_out"]:checked').value);
          //   formData.append('refundable', document.querySelector('input[name="refundable"]:checked').value);

          //   // Add file uploads
          //   for (let i = 1; i <= 4; i++) {
          //     const fileInput = document.getElementById(`image${i}`);
          //     if (fileInput.files[0]) {
          //       formData.append('images', fileInput.files[0]);
          //     }
          //   }

          //   // Add specifications
          //   const specifications = [];
          //   const details = [];
          //   document.querySelectorAll('#specifications-table-body tr').forEach(row => {
          //     specifications.push(row.cells[0].textContent.trim());
          //     details.push(row.cells[1].querySelector('input').value.trim());
          //   });
          //   formData.append('specifications', JSON.stringify(specifications));
          //   formData.append('details', JSON.stringify(details));

          //   // Submit the form
          //   try {
          //     const token = localStorage.getItem('token');
          //     const response = await fetch(`https://grabatoz-production.up.railway.app/api/products`, {
          //       method: 'POST',
          //       headers: {
          //         'Authorization': token
          //       },
          //       body: formData
          //     });

          //     const data = await response.json();

          //     if (!response.ok) {
          //       throw new Error(data.message || 'Failed to create product');
          //     }

          //     showSuccessMessage('Product created successfully!');
          //     document.getElementById('createProductForm').reset();
          //     bootstrap.Modal.getInstance(document.getElementById('createProductModal')).hide();

          //   } catch (error) {
          //     console.error('Product creation error:', error);
          //     showErrorMessage(`Error: ${error.message}`);
          //   }
          // }
          // async function submitProductForm(event) {
          //   event.preventDefault();

          //   // Basic validation
          //   const requiredFields = ['name', 'slug', 'sku', 'buying_price', 'selling_price'];
          //   const missingFields = requiredFields.filter(field => {
          //     const element = document.getElementById(field);
          //     return !element || !element.value.trim();
          //   });

          //   if (missingFields.length > 0) {
          //     showErrorMessage(`Please fill in all required fields: ${missingFields.join(', ')}`);
          //     return;
          //   }

          //   // Create FormData object
          //   const formData = new FormData();

          //   // Add all text fields
          //   const textFields = [
          //     'name', 'slug', 'sku', 'category', 'barcode',
          //     'buying_price', 'selling_price', 'tax', 'brand',
          //     'unit', 'weight', 'tags', 'description',
          //     'offer_price', 'discount', 'max_purchase_quantity',
          //     'low_stock_warning'
          //   ];

          //   textFields.forEach(field => {
          //     const value = document.getElementById(field)?.value || '';
          //     formData.append(field, value);
          //   });

          //   // Add radio button values
          //   const radioFields = ['status', 'can_purchasable', 'show_stock_out', 'refundable'];
          //   radioFields.forEach(field => {
          //     const selected = document.querySelector(`input[name="${field}"]:checked`);
          //     if (selected) formData.append(field, selected.value);
          //   });

          //   // Handle specifications
          //   const specifications = [];
          //   const details = [];
          //   document.querySelectorAll('#specifications-table-body tr').forEach(row => {
          //     const specName = row.cells[0].textContent.trim();
          //     const detailValue = row.cells[1].querySelector('input').value.trim();
          //     if (specName && detailValue) {
          //       specifications.push(specName);
          //       details.push(detailValue);
          //     }
          //   });
          //   formData.append('specifications', JSON.stringify(specifications));
          //   formData.append('details', JSON.stringify(details));

          //   // Handle file uploads
          //   for (let i = 1; i <= 4; i++) {
          //     const fileInput = document.getElementById(`image${i}`);
          //     if (fileInput && fileInput.files[0]) {
          //       formData.append('images', fileInput.files[0]);
          //     }
          //   }

          //   try {
          //     const token = localStorage.getItem('token');
          //     if (!token) {
          //       showErrorMessage('Authentication token missing. Please log in again.');
          //       return;
          //     }

          //     const response = await fetch(`https://grabatoz-production.up.railway.app/api/products`, {
          //       method: 'POST',
          //       headers: {
          //         'Authorization': token,
          //         // Don't set Content-Type for FormData - let browser set it with boundary
          //       },
          //       body: formData,
          //     });

          //     const data = await response.json();

          //     if (!response.ok) {
          //       throw new Error(data.message || 'Failed to save product');
          //     }

          //     showSuccessMessage('Product created successfully!');
          //     // Reset form and close modal
          //     document.getElementById('createProductForm').reset();
          //     bootstrap.Modal.getInstance(document.getElementById('createProductModal')).hide();
          //     // Refresh product list
          //     fetchProducts();
          //   } catch (error) {
          //     console.error('Product submission error:', error);
          //     showErrorMessage(error.message || 'Error saving product');
          //   }
          // }

          async function fetchProducts() {
            const token = localStorage.getItem('token') || 'your_default_token'; // Replace with actual token logic

            try {
              const response = await fetch(`${API_ADMINGRAB_URL}/api/products`, {
                method: 'GET',
                headers: {
                  'Authorization': token,
                },
              });

              if (!response.ok) throw new Error('Failed to fetch products');

              const products = await response.json();
              const productsTableBody = document.getElementById('productsTableBody');
              productsTableBody.innerHTML = ''; // Clear existing rows

              // Loop through products and create table rows
              products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                        <td>${product.name}</td>
                        <td>https://graba2z.netlify.app/product-details.html?slug=${product.slug}</td>
                        <td>${product.category_name || '—'}</td>
                        <td>${product.brand_name || '—'}</td>
                        <td>${product.buying_price}</td>
                        <td>${product.selling_price}</td>
                        <td>${product.status}</td>
                        <td>${product.short_description || '—'}</td>
                        <td class="action-buttons">
                            <button class="btn btn-view" onclick="showViewForm(${product.id})">👁</button>
                            <button class="btn btn-edit" onclick="openUpdateForm(${product.id})">✏️</button>
                            <button class="btn btn-delete" onclick="showConfirmDialog(${product.id})">🗑</button>
                        </td>
                    `;
                productsTableBody.appendChild(row);
              });
            } catch (error) {
              console.error('Error fetching products:', error);
            }
          }
          //         async function openUpdateForm(productId) {
          //     const token = localStorage.getItem('token'); // Retrieve token from local storage

          //     try {
          //         console.log('Opening update form for product ID:', productId); // Debugging log

          //         // Fetch product details from the API
          //         const response = await fetch(`https://grabatoz-production.up.railway.app/api/products/${productId}`, {
          //             method: 'GET',
          //             headers: {
          //                 'Authorization': token, // Ensure token is correctly passed
          //                 'Content-Type': 'application/json',
          //             },
          //         });

          //         if (!response.ok) {
          //             console.error('Failed to fetch product details:', response.status, response.statusText);
          //             throw new Error('Failed to fetch product details');
          //         }

          //         const { product } = await response.json(); // Extract product details
          //         console.log('Fetched product:', product); // Debugging log

          //         // Populate form fields with product data
          //         document.getElementById('updateProductForm').dataset.productId = productId;
          //         document.getElementById('update_name').value = product.name || '';
          //         document.getElementById('update_sku').value = product.sku || '';
          //         document.getElementById('update_barcode').value = product.barcode || '';
          //         document.getElementById('update_buying_price').value = product.buying_price || '';
          //         document.getElementById('update_selling_price').value = product.selling_price || '';
          //         document.getElementById('update_max_purchase_quantity').value = product.max_purchase_quantity || '';
          //         document.getElementById('update_low_stock_warning').value = product.low_stock_warning || '';
          //         document.getElementById('update_unit').value = product.unit || '';
          //         document.getElementById('update_weight').value = product.weight || '';
          //         document.getElementById('update_tags').value = product.tags || '';
          //         document.getElementById('update_description').value = product.description || '';

          //         // Select Category Name Instead of ID
          //         const categorySelect = document.getElementById('update_category');
          //         for (let option of categorySelect.options) {
          //             if (option.textContent === product.category_name) {
          //                 option.selected = true;
          //                 break;
          //             }
          //         }

          //         // Select Brand Name
          //         const brandSelect = document.getElementById('update_brand');
          //         for (let option of brandSelect.options) {
          //             if (option.textContent === product.brand) {
          //                 option.selected = true;
          //                 break;
          //             }
          //         }

          //         // Select Tax
          //         document.getElementById('update_tax').value = product.tax || '';

          //         // Handle radio buttons for Status, Can Purchasable, Show Stock Out, and Refundable
          //         document.querySelector(`input[name="update_status"][value="${product.status}"]`).checked = true;
          //         document.querySelector(`input[name="update_can_purchasable"][value="${product.can_purchasable}"]`).checked = true;
          //         document.querySelector(`input[name="update_show_stock_out"][value="${product.show_stock_out}"]`).checked = true;
          //         document.querySelector(`input[name="update_refundable"][value="${product.refundable}"]`).checked = true;

          //         // Show the modal
          //         const modal = new bootstrap.Modal(document.getElementById('updateProductModal'));
          //         modal.show();

          //     } catch (error) {
          //         console.error('Error opening update form:', error.message);
          //         showErrorMessage('Error loading product details');
          //     }
          // }

          // // Function to submit updated product details
          // async function submitUpdateProductForm() {
          //     const token = localStorage.getItem('token');
          //     const productId = document.getElementById('updateProductForm').dataset.productId;

          //     // Validate if the category is selected
          //     const categorySelect = document.getElementById('update_category');
          //     const categoryName = categorySelect.options[categorySelect.selectedIndex].textContent;

          //     if (!categoryName) {
          //         showErrorMessage('Please select a category');
          //         return;
          //     }

          //     // Prepare the updated product data
          //     const updatedData = {
          //         name: document.getElementById('update_name').value,
          //         sku: document.getElementById('update_sku').value,
          //         category: categoryName, // Send Category Name Instead of ID
          //         barcode: document.getElementById('update_barcode').value,
          //         buying_price: document.getElementById('update_buying_price').value,
          //         selling_price: document.getElementById('update_selling_price').value,
          //         tax: document.getElementById('update_tax').value,
          //         brand: document.getElementById('update_brand').value,
          //         status: document.querySelector('input[name="update_status"]:checked').value,
          //         can_purchasable: document.querySelector('input[name="update_can_purchasable"]:checked').value,
          //         show_stock_out: document.querySelector('input[name="update_show_stock_out"]:checked').value,
          //         refundable: document.querySelector('input[name="update_refundable"]:checked').value,
          //         max_purchase_quantity: document.getElementById('update_max_purchase_quantity').value,
          //         low_stock_warning: document.getElementById('update_low_stock_warning').value,
          //         unit: document.getElementById('update_unit').value,
          //         weight: document.getElementById('update_weight').value,
          //         tags: document.getElementById('update_tags').value,
          //         description: document.getElementById('update_description').value,
          //     };

          //     try {
          //         // Send the updated data to the API
          //         const response = await fetch(`https://grabatoz-production.up.railway.app/api/products/${productId}`, {
          //             method: 'PUT',
          //             headers: {
          //                 'Authorization': token,
          //                 'Content-Type': 'application/json',
          //             },
          //             body: JSON.stringify(updatedData),
          //         });

          //         if (!response.ok) throw new Error('Failed to update product');

          //         console.log('Product updated successfully');
          //         showSuccessMessage('Product updated successfully');

          //         // Close the modal
          //         const modalElement = document.getElementById('updateProductModal');
          //         const modalInstance = bootstrap.Modal.getInstance(modalElement);
          //         modalInstance.hide();

          //         // Refresh the product list
          //         fetchProducts();
          //     } catch (error) {
          //         console.error('Error updating product:', error);
          //         showErrorMessage('Error updating product');
          //     }
          // }


          // async function openUpdateForm(productId) {
          //   const token = localStorage.getItem('token'); // Retrieve token from local storage

          //   try {
          //     console.log('Opening update form for product ID:', productId); // Debugging log

          //     // Fetch product details from the API
          //     const response = await fetch(`https://grabatoz-production.up.railway.app/api/products/${productId}`, {
          //       method: 'GET',
          //       headers: {
          //         'Authorization': token, // Ensure token is correctly passed
          //         'Content-Type': 'application/json',
          //       },
          //     });

          //     if (!response.ok) {
          //       console.error('Failed to fetch product details:', response.status, response.statusText);
          //       throw new Error('Failed to fetch product details');
          //     }

          //     const { product } = await response.json(); // Extract product details
          //     console.log('Fetched product:', product); // Debugging log

          //     // Populate form fields with product data
          //     document.getElementById('updateProductForm').dataset.productId = productId;
          //     document.getElementById('update_name').value = product.name || '';
          //     document.getElementById('update_slug').value = product.slug || '';
          //     document.getElementById('update_sku').value = product.sku || '';
          //     document.getElementById('update_barcode').value = product.barcode || '';
          //     document.getElementById('update_buying_price').value = product.buying_price || '';
          //     document.getElementById('update_selling_price').value = product.selling_price || '';
          //     document.getElementById('update_max_purchase_quantity').value = product.max_purchase_quantity || '';
          //     document.getElementById('update_low_stock_warning').value = product.low_stock_warning || '';
          //     document.getElementById('update_unit').value = product.unit || '';
          //     document.getElementById('update_weight').value = product.weight || '';
          //     document.getElementById('update_tags').value = product.tags || '';
          //     document.getElementById('update_description').value = product.description || '';

          //     // Select Category Name Instead of ID
          //     const categorySelect = document.getElementById('update_category');
          //     for (let option of categorySelect.options) {
          //       if (option.textContent === product.category_name) {
          //         option.selected = true;
          //         break;
          //       }
          //     }

          //     // Select Brand Name
          //     const brandSelect = document.getElementById('update_brand');
          //     for (let option of brandSelect.options) {
          //       if (option.textContent === product.brand) {
          //         option.selected = true;
          //         break;
          //       }
          //     }

          //     // Select Tax
          //     document.getElementById('update_tax').value = product.tax || '';

          //     // Handle radio buttons for Status, Can Purchasable, Show Stock Out, and Refundable
          //     document.querySelector(`input[name="update_status"][value="${product.status}"]`).checked = true;
          //     document.querySelector(`input[name="update_can_purchasable"][value="${product.can_purchasable}"]`).checked = true;
          //     document.querySelector(`input[name="update_show_stock_out"][value="${product.show_stock_out}"]`).checked = true;
          //     document.querySelector(`input[name="update_refundable"][value="${product.refundable}"]`).checked = true;

          //     // Show the modal
          //     const modal = new bootstrap.Modal(document.getElementById('updateProductModal'));
          //     modal.show();

          //   } catch (error) {
          //     console.error('Error opening update form:', error.message);
          //     showErrorMessage('Error loading product details');
          //   }
          // }

          // Function to submit updated product details
          // async function submitUpdateProductForm() {
          //     const token = localStorage.getItem('token');
          //     const productId = document.getElementById('updateProductForm').dataset.productId;

          //     // Validate if the category is selected
          //     const categorySelect = document.getElementById('update_category');
          //     const categoryName = categorySelect.options[categorySelect.selectedIndex].textContent;

          //     if (!categoryName) {
          //         showErrorMessage('Please select a category');
          //         return;
          //     }

          //     // Prepare the updated product data
          //     const updatedData = {
          //         name: document.getElementById('update_name').value,
          //         slug: document.getElementById('update_slug').value,
          //         sku: document.getElementById('update_sku').value,
          //         category: categoryName, // Send Category Name Instead of ID
          //         barcode: document.getElementById('update_barcode').value,
          //         buying_price: document.getElementById('update_buying_price').value,
          //         selling_price: document.getElementById('update_selling_price').value,
          //         tax: document.getElementById('update_tax').value,
          //         brand: document.getElementById('update_brand').value,
          //         status: document.querySelector('input[name="update_status"]:checked').value,
          //         can_purchasable: document.querySelector('input[name="update_can_purchasable"]:checked').value,
          //         show_stock_out: document.querySelector('input[name="update_show_stock_out"]:checked').value,
          //         refundable: document.querySelector('input[name="update_refundable"]:checked').value,
          //         max_purchase_quantity: document.getElementById('update_max_purchase_quantity').value,
          //         low_stock_warning: document.getElementById('update_low_stock_warning').value,
          //         unit: document.getElementById('update_unit').value,
          //         weight: document.getElementById('update_weight').value,
          //         tags: document.getElementById('update_tags').value,
          //         description: document.getElementById('update_description').value,
          //     };

          //     try {
          //         // Send the updated data to the API
          //         const response = await fetch(`https://grabatoz-production.up.railway.app/api/products/${productId}`, {
          //             method: 'PUT',
          //             headers: {
          //                 'Authorization': token,
          //                 'Content-Type': 'application/json',
          //             },
          //             body: JSON.stringify(updatedData),
          //         });

          //         if (!response.ok) throw new Error('Failed to update product');

          //         console.log('Product updated successfully');
          //         showSuccessMessage('Product updated successfully');

          //         // Close the modal
          //         const modalElement = document.getElementById('updateProductModal');
          //         const modalInstance = bootstrap.Modal.getInstance(modalElement);
          //         modalInstance.hide();

          //         // Refresh the product list
          //         fetchProducts();
          //     } catch (error) {
          //         console.error('Error updating product:', error);
          //         showErrorMessage('Error updating product');
          //     }
          // }
          async function populateCategoryAndBrandSelects() {
            const token = localStorage.getItem('token');

            try {
              // Fetch categories
              const catResponse = await fetch(`https://grabatoz-production.up.railway.app/api/product-categories`, {
                headers: { 'Authorization': token }
              });
              const categories = await catResponse.json();

              const categorySelect = document.getElementById('update_category');
              categorySelect.innerHTML = '<option value="">Select a Category</option>';
              categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.id;
                option.textContent = cat.name;
                categorySelect.appendChild(option);
              });

              // Fetch brands
              const brandResponse = await fetch(`https://grabatoz-production.up.railway.app/api/product-brands`, {
                headers: { 'Authorization': token }
              });
              const brands = await brandResponse.json();

              const brandSelect = document.getElementById('update_brand');
              brandSelect.innerHTML = '<option value="">Select a Brand</option>';
              brands.forEach(brand => {
                const option = document.createElement('option');
                option.value = brand.id;
                option.textContent = brand.name;
                brandSelect.appendChild(option);
              });

            } catch (error) {
              console.error('Error loading categories/brands:', error);
            }
          }

          // Call this when the page loads or before showing the modal
          async function openUpdateForm(productId) {
            const token = localStorage.getItem('token');

            try {
              // First populate the select options
              await populateCategoryAndBrandSelects();

              // Then fetch product details
              const response = await fetch(`https://grabatoz-production.up.railway.app/api/products/${productId}`, {
                method: 'GET',
                headers: {
                  'Authorization': token,
                  'Content-Type': 'application/json',
                },
              });

              if (!response.ok) throw new Error('Failed to fetch product details');
              const { product } = await response.json();

              // Populate form fields
              document.getElementById('updateProductForm').dataset.productId = productId;
              document.getElementById('update_name').value = product.name || '';
              document.getElementById('update_slug').value = product.slug || '';
              // ... other fields ...

              // Set category and brand by ID (not name)
              document.getElementById('update_category').value = product.category || '';
              document.getElementById('update_brand').value = product.brand || '';

              // Handle radio buttons
              document.querySelector(`input[name="update_status"][value="${product.status}"]`).checked = true;
              document.querySelector(`input[name="update_can_purchasable"][value="${product.can_purchasable}"]`).checked = true;
              document.querySelector(`input[name="update_show_stock_out"][value="${product.show_stock_out}"]`).checked = true;
              document.querySelector(`input[name="update_refundable"][value="${product.refundable}"]`).checked = true;


              // Show the modal
              const modal = new bootstrap.Modal(document.getElementById('updateProductModal'));
              modal.show();

            } catch (error) {
              console.error('Error opening update form:', error);
              showErrorMessage('Error loading product details');
            }
          }



          async function submitUpdateProductForm() {
            // const token = localStorage.getItem('token');
            // const productId = document.getElementById('updateProductForm').dataset.productId;

            // // Get the selected category and brand IDs
            // const categorySelect = document.getElementById('update_category');
            // const categoryId = categorySelect.value;

            // const brandSelect = document.getElementById('update_brand');
            // const brandId = brandSelect.value;

            // if (!categoryId || !brandId) {
            //   showErrorMessage('Please select both category and brand');
            //   return;
            // }
            const token = localStorage.getItem('token');
            const productId = document.getElementById('updateProductForm').dataset.productId;

            // Get the IDs directly from the select values
            const categoryId = document.getElementById('update_category').value;
            const brandId = document.getElementById('update_brand').value;

            if (!categoryId || !brandId) {
              showErrorMessage('Please select both category and brand');
              return;
            }
            // Prepare the updated product data
            const updatedData = {
              name: document.getElementById('update_name').value,
              slug: document.getElementById('update_slug').value,
              sku: document.getElementById('update_sku').value,
              category: categoryId, // Category ID
              barcode: document.getElementById('update_barcode').value,
              buying_price: document.getElementById('update_buying_price').value,
              selling_price: document.getElementById('update_selling_price').value,
              tax: document.getElementById('update_tax').value,
              brand: brandId, // Brand ID instead of name
              status: document.querySelector('input[name="update_status"]:checked').value,
              can_purchasable: document.querySelector('input[name="update_can_purchasable"]:checked').value,
              show_stock_out: document.querySelector('input[name="update_show_stock_out"]:checked').value,
              refundable: document.querySelector('input[name="update_refundable"]:checked').value,
              max_purchase_quantity: document.getElementById('update_max_purchase_quantity').value,
              low_stock_warning: document.getElementById('update_low_stock_warning').value,
              unit: document.getElementById('update_unit').value,
              weight: document.getElementById('update_weight').value,
              tags: document.getElementById('update_tags').value,
              short_description: document.getElementById('update_short_description').value,
              description: document.getElementById('update_description').value,
            };

            try {
              const response = await fetch(`${API_ADMINGRAB_URL}/api/products/${productId}`, {
                method: 'PUT',
                headers: {
                  'Authorization': token,
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify(updatedData),
              });

              if (!response.ok) throw new Error('Failed to update product');

              console.log('Product updated successfully');
              showSuccessMessage('Product updated successfully');

              const modalElement = document.getElementById('updateProductModal');
              const modalInstance = bootstrap.Modal.getInstance(modalElement);
              modalInstance.hide();

              fetchProducts();
            } catch (error) {
              console.error('Error updating product:', error);
              showErrorMessage('Error updating product');
            }
          }

          // Show the confirmation dialog
          function showConfirmDialog(id) {
            // Create the dialog overlay
            const dialogOverlay = document.createElement('div');
            dialogOverlay.style.position = 'fixed';
            dialogOverlay.style.top = '0';
            dialogOverlay.style.left = '0';
            dialogOverlay.style.width = '100%';
            dialogOverlay.style.height = '100%';
            dialogOverlay.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            dialogOverlay.style.display = 'flex';
            dialogOverlay.style.justifyContent = 'center';
            dialogOverlay.style.alignItems = 'center';
            dialogOverlay.style.zIndex = '1000';
            dialogOverlay.setAttribute('id', 'confirmDialog');

            // Create the dialog box
            const dialogBox = document.createElement('div');
            dialogBox.style.backgroundColor = 'white';
            dialogBox.style.padding = '60px';
            dialogBox.style.borderRadius = '5px';
            dialogBox.style.textAlign = 'center';
            dialogBox.style.zIndex = '1001';

            // Create the warning icon
            const warningIcon = document.createElement('div');
            warningIcon.textContent = '!';
            warningIcon.style.fontSize = '40px';
            warningIcon.style.color = 'red';
            warningIcon.style.marginBottom = '10px';

            // Add title and message
            const title = document.createElement('h3');
            title.textContent = 'Are you sure?';

            const message = document.createElement('p');
            message.textContent = 'You will not be able to recover the deleted product!';

            // Create the buttons
            const confirmButton = document.createElement('button');
            confirmButton.textContent = 'Yes, Delete it!';
            confirmButton.style.marginRight = '10px';
            confirmButton.style.backgroundColor = 'rgb(105, 108, 255)';
            confirmButton.style.color = 'white';
            confirmButton.style.border = 'none';
            confirmButton.style.padding = '10px 20px';
            confirmButton.style.cursor = 'pointer';

            const cancelButton = document.createElement('button');
            cancelButton.textContent = 'No, Cancel!';
            cancelButton.style.backgroundColor = 'rgb(133, 146, 163)';
            cancelButton.style.color = 'white';
            cancelButton.style.border = 'none';
            cancelButton.style.padding = '10px 20px';
            cancelButton.style.cursor = 'pointer';

            // Append elements to the dialog box
            dialogBox.appendChild(warningIcon);
            dialogBox.appendChild(title);
            dialogBox.appendChild(message);
            dialogBox.appendChild(confirmButton);
            dialogBox.appendChild(cancelButton);

            // Append the dialog box to the overlay
            dialogOverlay.appendChild(dialogBox);

            // Append the overlay to the body
            document.body.appendChild(dialogOverlay);

            // Confirm button click handler
            confirmButton.addEventListener('click', function () {
              deleteProduct(id); // Call the delete function for the product
              closeConfirmDialog();
              showDeleteMessage("Product deleted successfully!");
            });

            // Cancel button click handler
            cancelButton.addEventListener('click', closeConfirmDialog);

            // Close the confirmation dialog
            function closeConfirmDialog() {
              document.body.removeChild(dialogOverlay);
            }
          }

          // Show delete success message
          function showDeleteMessage(message) {
            const messageContainer = document.createElement('div');
            messageContainer.style.position = 'fixed';
            messageContainer.style.top = '20px';
            messageContainer.style.right = '20px';
            messageContainer.style.backgroundColor = 'red';
            messageContainer.style.color = 'white';
            messageContainer.style.padding = '10px 20px';
            messageContainer.style.borderRadius = '5px';
            messageContainer.style.zIndex = '1000';
            messageContainer.textContent = message;

            document.body.appendChild(messageContainer);

            // Remove the message after 3 seconds
            setTimeout(() => {
              document.body.removeChild(messageContainer);
            }, 3000);
          }

          function showSuccessMessage(message) {
            const messageContainer = document.createElement('div');
            messageContainer.style.position = 'fixed';
            messageContainer.style.top = '20px';
            messageContainer.style.right = '20px';
            messageContainer.style.backgroundColor = 'green';
            messageContainer.style.color = 'white';
            messageContainer.style.padding = '10px 20px';
            messageContainer.style.borderRadius = '5px';
            messageContainer.style.zIndex = '1000';
            messageContainer.textContent = message;

            document.body.appendChild(messageContainer);

            // Remove the message after 3 seconds
            setTimeout(() => {
              document.body.removeChild(messageContainer);
            }, 3000);
          }

          // Function to delete a product
          async function deleteProduct(id) {
            const token = localStorage.getItem('token');

            try {
              const response = await fetch(`${apiUrl}/${id}`, {
                method: 'DELETE',
                headers: {
                  'Authorization': token,
                },
              });

              if (!response.ok) throw new Error('Failed to delete product');

              console.log('Product Deleted:', id);
              fetchProducts(); // Refresh the products list
            } catch (error) {
              console.error('Error deleting product:', error);
            }
          }

          // Example: Attach the delete confirmation to a delete button
          document.querySelectorAll('.btn-delete').forEach(button => {
            button.addEventListener('click', function () {
              const id = this.getAttribute('data-id');
              showConfirmDialog(id);
            });
          });

          // export Button
          document.getElementById('exportButton').addEventListener('click', async function () {
            try {
              // Get the auth token from local storage (or wherever you store it)
              const token = localStorage.getItem('token');

              if (!token) {
                alert('User is not authenticated. Please log in.');
                return;
              }

              // Fetch product data from the API with the Authorization header
              const response = await fetch(`https://grabatoz-production.up.railway.app/api/products`, {
                method: 'GET',
                headers: {
                  'Authorization': `${token}`, // Include the token for authentication
                  'Content-Type': 'application/json'
                }
              });

              // Check if the response status is unauthorized
              if (response.status === 401) {
                alert('Unauthorized request. Please log in again.');
                window.location.href = '/authentication-login.html';
                return;
              }

              // Check if the response is OK
              if (!response.ok) {
                throw new Error('Failed to fetch product data');
              }

              // Parse the JSON data
              const data = await response.json();

              // Prepare data for XLSX export
              const exportData = [
                ['ID', 'Name', 'Slug', 'Category', 'Buying Price', 'Selling Price', 'Status']
              ];

              // Map the fetched data to the export format
              data.forEach((product) => {
                exportData.push([
                  product.id,
                  product.name,
                  product.slug,
                  product.category || '—',
                  product.buying_price,
                  product.selling_price,
                  product.status || '—'
                ]);
              });

              // Create a new workbook and worksheet
              const wb = XLSX.utils.book_new();
              const ws = XLSX.utils.aoa_to_sheet(exportData);

              // Append worksheet to workbook
              XLSX.utils.book_append_sheet(wb, ws, 'Products');

              // Export to XLSX file
              XLSX.writeFile(wb, 'products.xlsx');
            } catch (error) {
              console.error('Error exporting file:', error.message);
              alert('Failed to export product data. Please try again.');
            }
          });


          // Toggle visibility of the filter form
          document.querySelector('.filter-btn').addEventListener('click', function () {
            const filterForm = document.getElementById('dropdownSearch');
            filterForm.classList.toggle('d-none'); // Toggles the 'd-none' class to show or hide the filter form
          });

          // Function to filter the table based on search input
          function filterTable() {
            const name = document.getElementById('searchName').value.toLowerCase();
            const category = document.getElementById('searchCategory').value.toLowerCase();
            const status = document.getElementById('searchStatus').value.toLowerCase();
            const buyingPrice = document.getElementById('searchBuyingPrice').value;
            const sellingPrice = document.getElementById('searchSellingPrice').value;

            const tableRows = document.querySelectorAll('#productsTableBody tr');

            tableRows.forEach(row => {
              const productName = row.cells[0].innerText.toLowerCase();
              const productCategory = row.cells[1].innerText.toLowerCase();
              const productBuyingPrice = row.cells[2].innerText;
              const productSellingPrice = row.cells[3].innerText;
              const productStatus = row.cells[4].innerText.toLowerCase();

              // Check if row matches the filter criteria
              const matchesName = !name || productName.includes(name);
              const matchesCategory = !category || productCategory.includes(category);
              const matchesStatus = !status || productStatus.includes(status);
              const matchesBuyingPrice = !buyingPrice || productBuyingPrice.includes(buyingPrice);
              const matchesSellingPrice = !sellingPrice || productSellingPrice.includes(sellingPrice);

              // Show or hide the row based on filter conditions
              if (matchesName && matchesCategory && matchesStatus && matchesBuyingPrice && matchesSellingPrice) {
                row.style.display = '';  // Show row
              } else {
                row.style.display = 'none';  // Hide row
              }
            });
          }

          // Function to clear all filter inputs and reset table display
          function clearFilters() {
            document.getElementById('searchName').value = '';
            document.getElementById('searchCategory').value = '';
            document.getElementById('searchStatus').value = '';
            document.getElementById('searchBuyingPrice').value = '';
            document.getElementById('searchSellingPrice').value = '';

            // Show all rows
            const tableRows = document.querySelectorAll('#productsTableBody tr');
            tableRows.forEach(row => {
              row.style.display = ''; // Show all rows
            });

            // Do NOT hide the filter form
            // Removed: document.getElementById('dropdownSearch').classList.add('d-none');
          }

          // async function showViewForm(productId) {
          //   try {
          //     console.log('Fetching product details for ID:', productId); // Debug log
          //     const response = await fetch(`https://grabatoz-production.up.railway.app/api/products/${productId}`, {
          //       method: 'GET',
          //       headers: {
          //         'Authorization': `${localStorage.getItem('token')}`, // Token for authentication
          //       },
          //     });

          //     // Handle the response
          //     if (response.ok) {
          //       const data = await response.json();
          //       console.log('API Response:', data); // Debug log

          //       const product = data.product;
          //       if (!product) {
          //         console.error('Product data is undefined');
          //         showErrorMessage('Product not found');
          //         return;
          //       }
          //       const imagePath = product.image_path
          //         ? `https://grabatoz-production.up.railway.app/${product.image_path}`
          //         : '/path/to/placeholder-image.jpg';  // Fallback path to a default image

          //       // Dynamically update the modal content
          //       document.getElementById('productName').innerText = product.name || '—';
          //       document.getElementById('productSlug').innerText = product.slug || '—';
          //       document.getElementById('productSKU').innerText = product.sku || '—';
          //       document.getElementById('productCategory').innerText = product.category || '—';
          //       document.getElementById('productBarcode').innerText = product.barcode || '—';
          //       document.getElementById('productBuyingPrice').innerText = product.buying_price || '—';
          //       document.getElementById('productSellingPrice').innerText = product.selling_price || '—';
          //       document.getElementById('productTax').innerText = product.tax || '—';
          //       document.getElementById('productBrand').innerText = product.brand || '—';
          //       document.getElementById('productStatus').innerText = product.status || '—';
          //       document.getElementById('productRefundable').innerText = product.refundable || '—';
          //       document.getElementById('productImage').src = imagePath || '';
          //       document.getElementById('productImage').alt = product.name || '';

          //       // Show the modal
          //       const modalElement = new bootstrap.Modal(document.getElementById('viewProductModal'));
          //       modalElement.show();
          //     } else {
          //       const errorData = await response.json();
          //       console.error('API Error:', errorData.message);
          //       showErrorMessage(errorData.message || 'Error fetching product details');
          //     }
          //   } catch (err) {
          //     console.error('Error fetching product details:', err);
          //     showErrorMessage('Failed to fetch product details');
          //   }
          // }



          // async function showViewForm(productId) {
          //   try {
          //     const response = await fetch(`https://grabatoz-production.up.railway.app/api/products/${productId}`, {
          //       method: 'GET',
          //       headers: {
          //         'Authorization': localStorage.getItem('token'),
          //       },
          //     });

          //     if (!response.ok) throw new Error('Failed to fetch product details');
          //     const data = await response.json();
          //     const product = data.product;

          //     if (!product) {
          //       showErrorMessage('Product not found');
          //       return;
          //     }

          //     // Set basic fields
          //     document.getElementById('productName').innerText = product.name || '—';
          //     document.getElementById('productSlug').innerText = product.slug || '—';
          //     document.getElementById('productSKU').innerText = product.sku || '—';
          //     document.getElementById('productCategory').innerText = product.category || '—';
          //     document.getElementById('productBarcode').innerText = product.barcode || '—';
          //     document.getElementById('productBuyingPrice').innerText = product.buying_price || '—';
          //     document.getElementById('productSellingPrice').innerText = product.selling_price || '—';
          //     document.getElementById('productTax').innerText = product.tax || '—';
          //     document.getElementById('productBrand').innerText = product.brand || '—';
          //     document.getElementById('productStatus').innerText = product.status || '—';
          //     document.getElementById('productRefundable').innerText = product.refundable || '—';

          //     // Display all product images
          //     const imageWrapper = document.getElementById('productImagesWrapper');
          //     imageWrapper.innerHTML = ''; // Clear old images

          //     if (product.image_paths) {
          //       const paths = product.image_paths.includes(',') ? product.image_paths.split(',') : JSON.parse(product.image_paths);
          //       paths.forEach(path => {
          //         const img = document.createElement('img');
          //         img.src = `https://grabatoz-production.up.railway.app/${path.trim()}`;
          //         img.alt = product.name;
          //         img.style.width = '100px';
          //         img.style.margin = '5px';
          //         imageWrapper.appendChild(img);
          //       });
          //     } else {
          //       imageWrapper.innerHTML = '<p>No images found</p>';
          //     }

          //     // Show modal
          //     const modalElement = new bootstrap.Modal(document.getElementById('viewProductModal'));
          //     modalElement.show();

          //   } catch (err) {
          //     console.error('Error fetching product details:', err);
          //     showErrorMessage('Failed to fetch product details');
          //   }
          // }

          // document.getElementById('saveButton').addEventListener('click', async () => {
          //   const fileInput = document.getElementById('fileInput');
          //   const file = fileInput.files[0];
          //   const token = localStorage.getItem('token'); // Retrieve token from localStorage

          //   if (!token) {
          //     showErrorMessage('Authentication token is missing. Please log in again.');
          //     return;
          //   }

          //   if (!file) {
          //     showErrorMessage('Please select a file to upload.');
          //     return;
          //   }

          //   const formData = new FormData();
          //   formData.append('file', file);

          //   try {
          //     const response = await fetch(`https://grabatoz-production.up.railway.app/api/products/uploadFile`, {
          //       method: 'POST',
          //       headers: {
          //         'Authorization': ` ${token}`, // Include token in the Authorization header
          //       },
          //       body: formData,
          //     });

          //     if (!response.ok) {
          //       const errorData = await response.json();
          //       throw new Error(errorData.message || 'Failed to upload file.');
          //     }

          //     const result = await response.json();
          //     alert(result.message);

          //     // Close the modal on successful upload
          //     const modalElement = document.getElementById('uploadModal');
          //     const modalInstance = bootstrap.Modal.getInstance(modalElement);
          //     modalInstance.hide();
          //   } catch (error) {
          //     console.error('Upload error:', error);
          //     showErrorMessage(error.message || 'An unexpected error occurred while uploading the file.');
          //   }
          // });
          // Submit Product Form
          async function submitProductForm(event) {
            event.preventDefault();

            const requiredFields = ['name', 'slug', 'sku', 'buying_price', 'selling_price'];
            const missingFields = requiredFields.filter(field => {
              const el = document.getElementById(field);
              return !el || !el.value.trim();
            });

            if (missingFields.length > 0) {
              showErrorMessage(`Please fill all required fields: ${missingFields.join(', ')}`);
              return;
            }

            const formData = new FormData();

            const fields = [
              'name', 'slug', 'sku', 'category', 'barcode',
              'buying_price', 'selling_price', 'tax', 'brand',
              'unit', 'weight', 'tags', 'short_description',  // added here
              'description', 'offer_price', 'discount',
              'max_purchase_quantity', 'low_stock_warning'
            ];

            fields.forEach(field => {
              formData.append(field, document.getElementById(field)?.value || '');
            });

            ['status', 'can_purchasable', 'show_stock_out', 'refundable'].forEach(field => {
              const selected = document.querySelector(`input[name="${field}"]:checked`);
              if (selected) formData.append(field, selected.value);
            });

            const specs = [];
            const details = [];
            document.querySelectorAll('#specifications-table-body tr').forEach(row => {
              const specName = row.cells[0].textContent.trim();
              const detailValue = row.cells[1].querySelector('input').value.trim();
              if (specName && detailValue) {
                specs.push(specName);
                details.push(detailValue);
              }
            });

            formData.append('specifications', JSON.stringify(specs));
            formData.append('details', JSON.stringify(details));

            for (let i = 1; i <= 4; i++) {
              const fileInput = document.getElementById(`image${i}`);
              if (fileInput?.files[0]) {
                formData.append('images', fileInput.files[0]);
              }
            }

            try {
              const token = localStorage.getItem('token');
              if (!token) {
                showErrorMessage('Authentication token missing. Please log in again.');
                return;
              }

              const res = await fetch(`${API_ADMINGRAB_URL}/api/products`, {
                method: 'POST',
                headers: { 'Authorization': token },
                body: formData,
              });

              const data = await res.json();

              if (!res.ok) throw new Error(data.error || 'Failed to save product');

              showSuccessMessage('Product created successfully!');
              document.getElementById('createProductForm').reset();
              bootstrap.Modal.getInstance(document.getElementById('createProductModal')).hide();
              fetchProducts();
            } catch (err) {
              console.error('Error:', err);
              showErrorMessage(err.message || 'Error saving product');
            }
          }

          // async function submitProductForm(event) {
          //   event.preventDefault();

          //   // Basic validation
          //   const requiredFields = ['name', 'slug', 'sku', 'buying_price', 'selling_price'];
          //   const missingFields = requiredFields.filter(field => {
          //     const element = document.getElementById(field);
          //     return !element || !element.value.trim();
          //   });

          //   if (missingFields.length > 0) {
          //     showErrorMessage(`Please fill in all required fields: ${missingFields.join(', ')}`);
          //     return;
          //   }

          //   // Create FormData object
          //   const formData = new FormData();

          //   // Add all text fields
          //   const textFields = [
          //     'name', 'slug', 'sku', 'category', 'barcode',
          //     'buying_price', 'selling_price', 'tax', 'brand',
          //     'unit', 'weight', 'tags', 'short_description', 'description',
          //     'offer_price', 'discount', 'max_purchase_quantity',
          //     'low_stock_warning'
          //   ];

          //   textFields.forEach(field => {
          //     const value = document.getElementById(field)?.value || '';
          //     formData.append(field, value);
          //   });

          //   // Add radio button values
          //   const radioFields = ['status', 'can_purchasable', 'show_stock_out', 'refundable'];
          //   radioFields.forEach(field => {
          //     const selected = document.querySelector(`input[name="${field}"]:checked`);
          //     if (selected) formData.append(field, selected.value);
          //   });

          //   // Handle specifications
          //   const specifications = [];
          //   const details = [];
          //   document.querySelectorAll('#specifications-table-body tr').forEach(row => {
          //     const specName = row.cells[0].textContent.trim();
          //     const detailValue = row.cells[1].querySelector('input').value.trim();
          //     if (specName && detailValue) {
          //       specifications.push(specName);
          //       details.push(detailValue);
          //     }
          //   });
          //   formData.append('specifications', JSON.stringify(specifications));
          //   formData.append('details', JSON.stringify(details));

          //   // Handle file uploads
          //   for (let i = 1; i <= 4; i++) {
          //     const fileInput = document.getElementById(`image${i}`);
          //     if (fileInput && fileInput.files[0]) {
          //       formData.append('images', fileInput.files[0]);
          //     }
          //   }

          //   try {
          //     const token = localStorage.getItem('token');
          //     if (!token) {
          //       showErrorMessage('Authentication token missing. Please log in again.');
          //       return;
          //     }

          //     const response = await fetch(`https://grabatoz-production.up.railway.app/api/products`, {
          //       method: 'POST',
          //       headers: {
          //         'Authorization': token,
          //       },
          //       body: formData,
          //     });

          //     const data = await response.json();

          //     if (!response.ok) {
          //       throw new Error(data.message || 'Failed to save product');
          //     }

          //     showSuccessMessage('Product created successfully!');
          //     document.getElementById('createProductForm').reset();
          //     bootstrap.Modal.getInstance(document.getElementById('createProductModal')).hide();
          //     fetchProducts();
          //   } catch (error) {
          //     console.error('Product submission error:', error);
          //     showErrorMessage(error.message || 'Error saving product');
          //   }
          // }

          // View Product Details
          async function showViewForm(productId) {
            try {
              const response = await fetch(`https://grabatoz-production.up.railway.app/api/products/${productId}`, {
                method: 'GET',
                headers: {
                  'Authorization': localStorage.getItem('token'),
                },
              });

              if (!response.ok) throw new Error('Failed to fetch product details');
              const data = await response.json();
              const product = data.product;

              if (!product) {
                showErrorMessage('Product not found');
                return;
              }

              // Set basic fields
              document.getElementById('productName').textContent = product.name || '—';
              document.getElementById('productSlug').textContent = `https://graba2z.netlify.app/product-details.html?slug=${product.slug}` || '—';
              document.getElementById('productSKU').textContent = product.sku || '—';
              document.getElementById('productCategory').textContent = product.category_name || '—';
              document.getElementById('productBarcode').textContent = product.barcode || '—';
              document.getElementById('productBuyingPrice').textContent = product.buying_price ? `$${product.buying_price}` : '—';
              document.getElementById('productSellingPrice').textContent = product.selling_price ? `$${product.selling_price}` : '—';
              document.getElementById('productTax').textContent = product.tax || '—';
              document.getElementById('productBrand').textContent = product.brand_name || '—';
              document.getElementById('productStatus').textContent = product.status || '—';
              document.getElementById('productRefundable').textContent = product.refundable || '—';
              document.getElementById('productShortDescription').textContent = product.short_description || '—';
              document.getElementById('productDescription').textContent = product.description || '—';

              // Display all product images
              const imageWrapper = document.getElementById('productImagesWrapper');
              imageWrapper.innerHTML = '';

              if (product.image_path || product.image_paths) {
                // Handle main image
                if (product.image_path) {
                  const mainImg = document.createElement('img');
                  mainImg.src = `https://grabatoz-production.up.railway.app/${product.image_path.replace(/\\/g, '/')}`;
                  mainImg.alt = product.name;
                  mainImg.className = 'img-thumbnail m-2';
                  mainImg.style.maxWidth = '200px';
                  mainImg.style.maxHeight = '200px';
                  imageWrapper.appendChild(mainImg);
                }

                // Handle gallery images
                let galleryImages = [];
                if (product.image_paths) {
                  try {
                    // Try to parse as JSON array
                    galleryImages = Array.isArray(product.image_paths) ?
                      product.image_paths :
                      JSON.parse(product.image_paths);
                  } catch (e) {
                    // Fallback to comma-separated string
                    galleryImages = product.image_paths.split(',');
                  }
                }

                galleryImages.forEach(path => {
                  if (!path) return;
                  const cleanPath = path.replace(/['"\\]/g, '').trim();
                  if (!cleanPath) return;

                  const img = document.createElement('img');
                  img.src = `https://grabatoz-production.up.railway.app/${cleanPath}`;
                  img.alt = product.name;
                  img.className = 'img-thumbnail m-2';
                  img.style.maxWidth = '150px';
                  img.style.maxHeight = '150px';
                  imageWrapper.appendChild(img);
                });
              }

              if (imageWrapper.children.length === 0) {
                imageWrapper.innerHTML = '<p>No images available</p>';
              }

              // Show modal
              const modalElement = new bootstrap.Modal(document.getElementById('viewProductModal'));
              modalElement.show();

            } catch (err) {
              console.error('Error fetching product details:', err);
              showErrorMessage('Failed to fetch product details');
            }
          }

          // Image Preview Functionality (Add this to your initialization code)
          document.addEventListener('DOMContentLoaded', function () {
            // Add image preview for file inputs
            document.querySelectorAll('input[type="file"]').forEach(input => {
              input.addEventListener('change', function (e) {
                const previewId = this.id + '-preview';
                const previewContainer = this.parentNode;
                let preview = document.getElementById(previewId);

                // Remove old preview if exists
                if (preview) {
                  preview.remove();
                }

                // Create new preview if file selected
                if (this.files && this.files[0]) {
                  preview = document.createElement('img');
                  preview.id = previewId;
                  preview.style.maxWidth = '100px';
                  preview.style.maxHeight = '100px';
                  preview.className = 'img-thumbnail mt-2 d-block';
                  preview.src = URL.createObjectURL(this.files[0]);
                  previewContainer.appendChild(preview);
                }
              });
            });
          });
          // document.getElementById('saveButton').addEventListener('click', async () => {
          //   const fileInput = document.getElementById('fileInput');
          //   const file = fileInput.files[0];
          //   const token = localStorage.getItem('token');

          //   if (!file) return showErrorMessage('Please select a file to upload.');
          //   if (!token) return showErrorMessage('Login required. No token found.');

          //   const formData = new FormData();
          //   formData.append('file', file);

          //   try {
          //     const response = await fetch(`${API_ADMINGRAB_URL}/api/products/uploadFile`, {
          //       method: 'POST',
          //       headers: {
          //         'Authorization': token
          //       },
          //       body: formData
          //     });

          //     const result = await response.json();
          //     console.log('✅ Upload API Response:', result); // Debug log

          //     if (!response.ok) throw new Error(result.error || 'Upload failed.');

          //     // Extract safe values
          //     const total = Number(result.totalRows) || 0;
          //     const inserted = Number(result.inserted) || 0;
          //     const skipped = Number(result.skipped) || 0;
          //     const errors = result.errors || [];

          //     let message = `✅ Total Products: ${total}\n🟢 Inserted: ${inserted}\n⛔ Skipped: ${skipped}`;

          //     if (errors.length > 0) {
          //       message += `\n\n❌ Errors:\n`;
          //       message += errors.slice(0, 5).map(err => `• ${err.name}: ${err.reason}`).join('\n');
          //       if (errors.length > 5) message += `\n...and ${errors.length - 5} more.`;
          //     }

          //     alert(message); // ✅ Always alert summary
          //     fileInput.value = '';

          //     const modal = bootstrap.Modal.getInstance(document.getElementById('uploadModal'));
          //     if (modal) modal.hide();

          //   } catch (err) {
          //     console.error('❌ Upload error:', err);
          //     showErrorMessage(err.message || 'Something went wrong during upload.');
          //   }
          // });

          // document.getElementById('saveButton').addEventListener('click', async () => {
          //   const fileInput = document.getElementById('fileInput');
          //   const file = fileInput.files[0];
          //   const token = localStorage.getItem('token');

          //   if (!file) return showErrorMessage('Please select a file to upload.');
          //   if (!token) return showErrorMessage('Login required. No token found.');

          //   const formData = new FormData();
          //   formData.append('file', file);

          //   try {
          //     const response = await fetch(`${API_ADMINGRAB_URL}/api/products/uploadFile`, {
          //       method: 'POST',
          //       headers: { 'Authorization': token },
          //       body: formData
          //     });

          //     const result = await response.json();

          //     if (!response.ok) {
          //       throw new Error(result.error || 'Upload failed.');
          //     }

          //     const inserted = result.inserted ?? 0;
          //     const skipped = result.skipped ?? 0;

          //     // Display better alert
          //     alert(`✅ Successfully uploaded ${inserted} products.\n⛔ Skipped ${skipped} duplicate products.`);

          //     // Reset file input
          //     fileInput.value = '';

          //     // Close modal
          //     const modal = bootstrap.Modal.getInstance(document.getElementById('uploadModal'));
          //     if (modal) modal.hide();
          //   } catch (err) {
          //     console.error('Upload error:', err);
          //     showErrorMessage(err.message || 'Unexpected upload error');
          //   }
          // });

          // document.getElementById('saveButton').addEventListener('click', async () => {
          //   const fileInput = document.getElementById('fileInput');
          //   const file = fileInput.files[0];
          //   const token = localStorage.getItem('token');

          //   if (!file) return showErrorMessage('Please select a file to upload.');
          //   if (!token) return showErrorMessage('Login required. No token found.');

          //   const formData = new FormData();
          //   formData.append('file', file);

          //   try {
          //     const response = await fetch(`https://grabatoz-production.up.railway.app/api/products/uploadFile`, {
          //       method: 'POST',
          //       headers: { 'Authorization': token },
          //       body: formData
          //     });

          //     const result = await response.json();

          //     if (!response.ok) throw new Error(result.error || 'Upload failed.');

          //     const inserted = result.inserted ?? 0;
          //     const skipped = result.skipped ?? 0;

          //     alert(`✅ Successfully uploaded ${inserted} products.\n⛔ Skipped ${skipped} duplicate products.`);

          //     fileInput.value = '';
          //     const modal = bootstrap.Modal.getInstance(document.getElementById('uploadModal'));
          //     if (modal) modal.hide();
          //   } catch (err) {
          //     console.error('Upload error:', err);
          //     showErrorMessage(err.message || 'Unexpected upload error');
          //   }
          // });



          //           document.getElementById('saveButton').addEventListener('click', async () => {
          //     const fileInput = document.getElementById('fileInput');
          //     const file = fileInput.files[0];
          //     const token = localStorage.getItem('token');

          //     if (!file) return showErrorMessage('Please select a file to upload.');
          //     if (!token) return showErrorMessage('Login required. No token found.');

          //     // Show loading indicator
          //     const saveButton = document.getElementById('saveButton');
          //     saveButton.disabled = true;
          //     saveButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Uploading...';

          //     const formData = new FormData();
          //     formData.append('file', file);

          //     try {
          //         const response = await fetch(`https://grabatoz-production.up.railway.app/api/products/uploadFile`, {
          //             method: 'POST',
          //             headers: { 'Authorization': token },
          //             body: formData
          //         });

          //         const result = await response.json();

          //         if (!response.ok) {
          //             let errorMsg = result.error || 'Upload failed.';
          //             if (result.details) errorMsg += ` (${result.details})`;
          //             throw new Error(errorMsg);
          //         }

          //         const inserted = result.inserted ?? 0;
          //         const skipped = result.skipped ?? 0;

          //         alert(`✅ Successfully uploaded ${inserted} products.\n⛔ Skipped ${skipped} duplicate products.`);

          //         fileInput.value = '';
          //         const modal = bootstrap.Modal.getInstance(document.getElementById('uploadModal'));
          //         if (modal) modal.hide();
          //     } catch (err) {
          //         console.error('Upload error:', err);
          //         showErrorMessage(err.message || 'Unexpected upload error');
          //     } finally {
          //         saveButton.disabled = false;
          //         saveButton.textContent = 'Upload File';
          //     }
          // });
          //           // document.getElementById('saveButton').addEventListener('click', async () => {
          //   const fileInput = document.getElementById('fileInput');
          //   const file = fileInput.files[0];
          //   const token = localStorage.getItem('token');

          //   if (!file) return showErrorMessage('Please select a file to upload.');
          //   if (!token) return showErrorMessage('Login required. No token found.');

          //   const formData = new FormData();
          //   formData.append('file', file);

          //   try {
          //     const response = await fetch(`https://grabatoz-production.up.railway.app/api/products/uploadFile`, {
          //       method: 'POST',
          //       headers: { 'Authorization': token },
          //       body: formData
          //     });

          //     const result = await response.json();

          //     if (!response.ok) {
          //       throw new Error(result.error || 'Upload failed.');
          //     }

          //     const inserted = result.inserted ?? 0;
          //     const skipped = result.skipped ?? 0;

          //     // Display better alert
          //     alert(`✅ Successfully uploaded ${inserted} products.\n⛔ Skipped ${skipped} duplicate products.`);

          //     // Reset file input
          //     fileInput.value = '';

          //     // Close modal
          //     const modal = bootstrap.Modal.getInstance(document.getElementById('uploadModal'));
          //     if (modal) modal.hide();
          //   } catch (err) {
          //     console.error('Upload error:', err);
          //     showErrorMessage(err.message || 'Unexpected upload error');
          //   }
          // });

          //           document.getElementById('saveButton').addEventListener('click', async () => {
          //     const fileInput = document.getElementById('fileInput');
          //     const file = fileInput.files[0];
          //     const token = localStorage.getItem('token');

          //     if (!file) return showErrorMessage('Please select a file to upload.');
          //     if (!token) return showErrorMessage('Login required. No token found.');

          //     const formData = new FormData();
          //     formData.append('file', file);

          //     try {
          //         const response = await fetch(`https://grabatoz-production.up.railway.app/api/products/uploadFile`, {
          //             method: 'POST',
          //             headers: { 'Authorization': token },
          //             body: formData
          //         });

          //         const result = await response.json();

          //         if (!response.ok) {
          //             throw new Error(result.error || 'Upload failed.');
          //         }

          //         // Check if inserted and skipped keys exist
          //         const inserted = result.inserted ?? 0;
          //         const skipped = result.skipped ?? 0;

          //         // Show proper alert
          //         alert(`✅ Successfully uploaded ${inserted} products.\n⛔ Skipped ${skipped} duplicate products.`);

          //         // Close modal
          //         const modal = bootstrap.Modal.getInstance(document.getElementById('uploadModal'));
          //         modal.hide();
          //     } catch (err) {
          //         console.error('Upload error:', err);
          //         showErrorMessage(err.message || 'Unexpected upload error');
          //     }
          // });

          // document.getElementById('saveButton').addEventListener('click', async () => {
          //   const fileInput = document.getElementById('fileInput');
          //   const file = fileInput.files[0];
          //   const token = localStorage.getItem('token');

          //   if (!file) return showErrorMessage('Please select a file to upload.');
          //   if (!token) return showErrorMessage('Login required. No token found.');

          //   const formData = new FormData();
          //   formData.append('file', file);

          //   try {
          //     const response = await fetch(`https://grabatoz-production.up.railway.app/api/products/uploadFile`, {
          //       method: 'POST',
          //       headers: { 'Authorization': token },
          //       body: formData
          //     });

          //     const result = await response.json();
          //     if (!response.ok) throw new Error(result.error || 'Upload failed.');

          //     alert(result.message);

          //     // Close modal
          //     const modal = bootstrap.Modal.getInstance(document.getElementById('uploadModal'));
          //     modal.hide();
          //   } catch (err) {
          //     console.error('Upload error:', err);
          //     showErrorMessage(err.message || 'Unexpected upload error');
          //   }
          // });


          document.getElementById('saveButton').addEventListener('click', async () => {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            const token = localStorage.getItem('token');

            if (!file) return showErrorMessage('Please select a file to upload.');
            if (!token) return showErrorMessage('Login required. No token found.');

            const loader = document.getElementById('uploadLoader');
            loader.classList.remove('d-none'); // Show spinner

            const formData = new FormData();
            formData.append('file', file);

            try {
              const response = await fetch(`${API_ADMINGRAB_URL}/api/products/uploadFile`, {
                method: 'POST',
                headers: {
                  'Authorization': token
                },
                body: formData
              });

              const result = await response.json();

              if (!response.ok) throw new Error(result.error || 'Upload failed.');

              let message = `✅ Total Products: ${result.totalRows}\n🟢 Inserted: ${result.inserted}\n⛔ Skipped: ${result.skipped}`;
              if (result.errors && result.errors.length > 0) {
                message += `\n\n❌ Skipped Reasons:\n`;
                message += result.errors.slice(0, 5).map(e => `• ${e.name}: ${e.reason}`).join('\n');
                if (result.errors.length > 5) message += `\n...and ${result.errors.length - 5} more.`;
              }

              setTimeout(() => {
                alert(message);
                fileInput.value = '';

                const modal = bootstrap.Modal.getInstance(document.getElementById('uploadModal'));
                if (modal) modal.hide();

                loader.classList.add('d-none'); // Hide spinner after everything
              }, 500);

            } catch (err) {
              console.error('❌ Upload error:', err);
              showErrorMessage(err.message || 'Something went wrong during upload.');
              loader.classList.add('d-none'); // Hide spinner on error
            }
          });


          fetchProducts()

        </script>
</body>

</html>